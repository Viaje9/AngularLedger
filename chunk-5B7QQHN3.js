import{a as h,b as fe,c as ae,d as Ve,h as he,i as ve,j as _e,s as xe,t as y}from"./chunk-ZJK5TM62.js";import{$c as K,Aa as o,Ba as s,Ca as u,Cb as ne,Da as C,Ga as p,Ia as m,M as S,Na as k,O as G,Oa as b,Oc as q,Pa as A,Qa as ce,Ra as l,Rc as z,S as _,Sa as P,T as x,Ta as w,Va as F,Wa as B,Wc as H,Xa as U,Ya as N,Za as $,_a as te,ad as re,d as Fe,e as Y,ed as X,fb as J,ga as d,ha as f,jb as pe,k as le,kb as ue,o as Z,ob as ie,pa as T,pb as me,qb as M,ra as g,rb as ge,sa as ee,ub as W,va as E,x as j,xa as Q,ya as I,za as D}from"./chunk-R5WM43LX.js";var v=function(i){return i.Add="add",i.Edit="edit",i}(v||{});var V=Fe(Ve());var Oe=(i,t)=>t.id;function je(i,t){if(i&1&&l(0),i&2){let n=m();w(" ",n.calculateDiffRangeDay()||""," ")}}function Pe(i,t){if(i&1){let n=C();o(0,"div",27),p("click",function(){let r=_(n).$implicit,c=m();return x(c.goToEditTag(r))}),o(1,"span"),u(2,"i",28),o(3,"span"),l(4),s()(),o(5,"span"),l(6),N(7,"number"),s()()}if(i&2){let n=t.$implicit;d(2),g("ngClass",n.tagInfo.tagIconName),d(2),P(n.tagInfo.tagName),d(2),w("$ ",$(7,3,n.price),"")}}function Ne(i,t){if(i&1&&(o(0,"div",29)(1,"div",4)(2,"div",30)(3,"div",31)(4,"span",32),l(5),N(6,"number"),s(),o(7,"span",33),l(8,"\u9031\u671F\u9918\u984D"),s()()(),o(9,"div",30)(10,"div",31)(11,"span",32),l(12),N(13,"number"),s(),o(14,"span",33),l(15,"\u6BCF\u65E5\u5269\u9918"),s()()(),o(16,"div",30)(17,"div",34)(18,"span",32),l(19),N(20,"number"),s(),o(21,"span",33),l(22,"\u5269\u9918\u9810\u7B97"),s()(),l(23," / "),o(24,"div",35)(25,"span",32),l(26),N(27,"number"),s(),o(28,"span",33),l(29,"\u9810\u7B97\u7E3D\u984D"),s()()()()()),i&2){let n=m();d(5),w("$ ",$(6,4,n.calculateRangeDayBudget()),""),d(7),w("$ ",$(13,6,n.calculateTodayBudget()),""),d(7),w("$ ",$(20,8,n.currentRangeBudget),""),d(7),w("$ ",$(27,10,n.budgetAmount),"")}}var Ce=(i,t)=>({"bg-red-600":i,"bg-green-600":t}),$e=(i,t)=>({"bg-red-800":i,"bg-green-800":t}),ye=(i,t)=>({"bg-red-500":i,"bg-green-500":t}),Te=i=>({"bg-gray-400":i}),O,oe=(O=class{get TransactionTypeEnum(){return h}constructor(t,n,e,a){this.router=t,this.loaderService=n,this.ledgerService=e,this.modalService=a,this.transactionType=this.TransactionTypeEnum.Expense,this.currentDate=new Date,this.ledgerItems=[],this.showBudget=localStorage.getItem("showBudget")==="1",this.budgetAmount=parseInt(localStorage.getItem("budgetAmount")||"0"),this.currentRangeBudget=0,this.startDate="",this.endDate="";let r=t?.getCurrentNavigation()?.extras.state?.transactionType,c=t?.getCurrentNavigation()?.extras.state?.date;r&&(this.transactionType=r),c&&(this.currentDate=c),this.transactionType===this.TransactionTypeEnum.Expense&&this.getExpenseList(),this.transactionType===this.TransactionTypeEnum.Income&&this.getIncomeList(),this.currentDate.setHours(0,0,0,0)}ngOnInit(){this.countBudget()}countBudget(){let t=parseInt(localStorage.getItem("selectedDate")||"0");if(t){let n=(0,V.default)(this.currentDate),e,a;n.date()>=t?(e=n.date(t),a=n.add(1,"month").date(t).subtract(1,"day")):(e=n.subtract(1,"month").date(t),a=n.date(t).subtract(1,"day"));let r=e.format("YYYY/MM/DD"),c=a.format("YYYY/MM/DD");this.transactionType===this.TransactionTypeEnum.Expense&&r!==this.startDate&&c!==this.endDate&&(this.startDate=r,this.endDate=c,this.ledgerService.getBudgetAmount(e.toDate(),a.toDate()).pipe(ae(this)).subscribe(R=>{this.currentRangeBudget=this.budgetAmount-R}))}}calculateDiffRangeDay(){let t=(0,V.default)(this.currentDate);return(0,V.default)(this.endDate,"YYYY/MM/DD").diff(t,"day")+1}calculateRangeDayBudget(){let t=(0,V.default)(this.currentDate),e=(0,V.default)(this.endDate,"YYYY/MM/DD").diff(t,"day")+1;return parseInt((this.currentRangeBudget/e).toFixed())-this.totalAmount()}calculateTodayBudget(){let t=(0,V.default)(this.startDate,"YYYY/MM/DD"),e=(0,V.default)(this.endDate,"YYYY/MM/DD").diff(t,"day")+1;return parseInt((this.budgetAmount/e).toFixed())-this.totalAmount()}onSwipeLeft(){let t=structuredClone(this.currentDate);t.setDate(this.currentDate.getDate()+1),this.currentDate=t,this.onDateChange()}onSwipeRight(){let t=structuredClone(this.currentDate);t.setDate(this.currentDate.getDate()-1),this.currentDate=t,this.onDateChange()}onDateChange(){this.transactionType===this.TransactionTypeEnum.Expense&&this.getExpenseList(),this.transactionType===this.TransactionTypeEnum.Income&&this.getIncomeList(),this.countBudget()}formateDate(t){return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`}onClickAdd(){this.transactionType===this.TransactionTypeEnum.Expense&&this.router.navigate(["/addExpense"],{state:{expenseStatus:v.Add,date:this.currentDate}}),this.transactionType===this.TransactionTypeEnum.Income&&this.router.navigate(["/addIncome"],{state:{incomeStatus:v.Add,date:this.currentDate}})}getExpenseList(){this.loaderService.start(),this.ledgerService.getTodayExpenseList(this.currentDate).pipe(j(1),ae(this)).subscribe(t=>{this.ledgerItems=t,this.loaderService.stop()})}getIncomeList(){this.loaderService.start(),this.ledgerService.getTodayIncomeList(this.currentDate).pipe(j(1),ae(this)).subscribe(t=>{this.ledgerItems=t,this.loaderService.stop()})}totalAmount(){return this.ledgerItems.reduce((t,n)=>t+parseInt(n.price),0)}goToEditTag(t){let n={expenseStatus:v.Edit,docId:t.id,date:t.date,price:t.price,tagId:t.tagId,description:t.description};this.router.navigate(["/addExpense"],{state:n})}changeTransactionType(t){this.transactionType=t,this.transactionType===this.TransactionTypeEnum.Expense?this.getExpenseList():this.transactionType===this.TransactionTypeEnum.Income&&this.getIncomeList()}onClickStatistics(){localStorage.getItem("showBudget")==="1"?this.router.navigate(["/setting/statisticsCharts"],{state:{date:this.currentDate}}):this.modalService.openConfirm({title:"\u901A\u77E5",content:"\u8ACB\u5148\u8A2D\u5B9A\u9810\u7B97\u9031\u671F\uFF0C\u518D\u67E5\u770B\u7D71\u8A08\u5716\u8868",okText:"\u78BA\u8A8D",outsideClose:!1,onOk:()=>{this.router.navigate(["/setting/budget"],{state:{date:this.currentDate}})}})}},O.\u0275fac=function(n){return new(n||O)(f(M),f(W),f(y),f(q))},O.\u0275cmp=G({type:O,selectors:[["app-ledger-overview"]],standalone:!0,features:[F],decls:44,vars:33,consts:[[1,"bg-gray-100","h-dvh","flex","flex-col"],[1,"flex","flex-col","flex-1"],[1,"sticky","top-0"],[1,"p-4","text-white",3,"ngClass"],[1,"flex","justify-between","items-center"],[1,"w-1/5","text-2xl"],[1,"flex","items-center","justify-center","w-3/5",3,"click"],["src","https://img.icons8.com/ios-filled/50/ffffff/calendar.png","alt","Calendar",1,"h-6","w-6","me-2"],["matInput","","readonly","",1,"text-2xl","w-36","mr-3","focus:outline-none",3,"ngClass","ngModel","matDatepicker","ngModelChange","dateChange"],["touchUi",""],["picker",""],[1,"w-1/5","flex","justify-end"],[1,"p-2","rounded-full",3,"ngClass","click"],["src","https://img.icons8.com/ios-filled/50/ffffff/plus-math.png","alt","Add",1,"h-6","w-6"],[1,"flex","justify-between","items-center","text-4xl"],[1,"wrapper","flex-1","p-4","space-y-2",3,"ngClass","swipeLeft","swipeRight"],[1,"sticky","bottom-0"],["routerLink","/setting/budget","class","bg-red-300 p-4 text-red-800"],[1,"flex","justify-around","items-center","bg-gray-200"],[1,"w-1/4","p-4","pb-8",3,"ngClass","click"],[1,"fas","fa-arrow-up"],[1,"block","text-lg"],[1,"fas","fa-arrow-down"],[1,"w-1/4","p-4","pb-8",3,"click"],[1,"fas","fa-chart-line"],["routerLink","setting",1,"w-1/4","p-4","pb-8"],[1,"fas","fa-cog"],[1,"bg-white","p-2","flex","justify-between","items-center",3,"click"],[1,"w-5","mr-1",3,"ngClass"],["routerLink","/setting/budget",1,"bg-red-300","p-4","text-red-800"],[1,"flex"],[1,"mr-1","flex","flex-col","items-center"],[1,"text-xl","block"],[1,"text-sm"],[1,"mr-1","flex","flex-col","items-end"],[1,"ml-1","flex","flex-col","items-end"],["class","bg-white p-2 flex justify-between items-center"]],template:function(n,e){if(n&1){let a=C();o(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5),T(6,je,1,1),s(),o(7,"div",6),p("click",function(){_(a);let c=ce(11);return x(c.open())}),u(8,"img",7),o(9,"input",8),p("ngModelChange",function(c){return e.currentDate=c})("dateChange",function(){return e.onDateChange()}),s(),u(10,"mat-datepicker",9,10),s(),o(12,"div",11)(13,"button",12),p("click",function(){return e.onClickAdd()}),u(14,"img",13),s()()()(),o(15,"div",3)(16,"div",14)(17,"span"),l(18,"TWD"),s(),o(19,"span"),l(20),N(21,"number"),s()()()(),o(22,"div",15),p("swipeLeft",function(){return e.onSwipeLeft()})("swipeRight",function(){return e.onSwipeRight()}),I(23,Pe,8,5,"div",36,Oe),s()(),o(25,"div",16),T(26,Ne,30,12,"div",17),o(27,"div",18)(28,"button",19),p("click",function(){return e.changeTransactionType(e.TransactionTypeEnum.Expense)}),u(29,"i",20),o(30,"span",21),l(31,"\u652F\u51FA"),s()(),o(32,"button",19),p("click",function(){return e.changeTransactionType(e.TransactionTypeEnum.Income)}),u(33,"i",22),o(34,"span",21),l(35,"\u6536\u5165"),s()(),o(36,"button",23),p("click",function(){return e.onClickStatistics()}),u(37,"i",24),o(38,"span",21),l(39,"\u7D71\u8A08"),s()(),o(40,"button",25),u(41,"i",26),o(42,"span",21),l(43,"\u8A2D\u5B9A"),s()()()()()}if(n&2){let a=ce(11);d(3),g("ngClass",U(14,Ce,e.transactionType===e.TransactionTypeEnum.Expense,e.transactionType===e.TransactionTypeEnum.Income)),d(3),E(6,e.transactionType===e.TransactionTypeEnum.Expense?6:-1),d(3),g("ngClass",U(17,Ce,e.transactionType===e.TransactionTypeEnum.Expense,e.transactionType===e.TransactionTypeEnum.Income))("ngModel",e.currentDate)("matDatepicker",a),d(4),g("ngClass",U(20,$e,e.transactionType===e.TransactionTypeEnum.Expense,e.transactionType===e.TransactionTypeEnum.Income)),d(2),g("ngClass",U(23,ye,e.transactionType===e.TransactionTypeEnum.Expense,e.transactionType===e.TransactionTypeEnum.Income)),d(5),P($(21,12,e.totalAmount())),d(2),g("ngClass",U(26,ye,e.transactionType===e.TransactionTypeEnum.Expense,e.transactionType===e.TransactionTypeEnum.Income)),d(),D(e.ledgerItems),d(3),E(26,e.transactionType===e.TransactionTypeEnum.Expense&&e.showBudget?26:-1),d(2),g("ngClass",B(29,Te,e.transactionType===e.TransactionTypeEnum.Expense)),d(4),g("ngClass",B(31,Te,e.transactionType===e.TransactionTypeEnum.Income))}},dependencies:[X,J,z,H,K,ge,pe,xe,he,ve,_e],styles:["[_nghost-%COMP%]{display:block}.wrapper[_ngcontent-%COMP%]{overflow-y:auto;touch-action:pan-y!important}"]}),O);oe=le([fe()],oe);var be=(()=>{let t=class t{ngOnInit(){}};t.\u0275fac=function(a){return new(a||t)},t.\u0275cmp=G({type:t,selectors:[["app-ledger"]],standalone:!0,features:[F],decls:1,vars:0,template:function(a,r){a&1&&u(0,"router-outlet")},dependencies:[ue,me],styles:["[_nghost-%COMP%]{display:block}"]});let i=t;return i})();var Ye=["scrollTags"],Qe=["tagGroup"],Ue=["templateRef"],Je=["priceInput"];function We(i,t){if(i&1){let n=C();o(0,"button",20),p("click",function(){_(n);let a=m();return x(a.onClickSave())}),l(1," \u5132\u5B58 "),s()}}function qe(i,t){if(i&1){let n=C();o(0,"button",20),p("click",function(){_(n);let a=m();return x(a.onClickEdit())}),l(1," \u5132\u5B58 "),s()}}var ze=(i,t)=>t.id,He=i=>({"bg-neutral-300":i});function Ke(i,t){if(i&1){let n=C();o(0,"div",24),p("click",function(){let r=_(n).$implicit,c=m(2);return x(c.onTagClick(r.id))}),u(1,"i",25),o(2,"p"),l(3),s()()}if(i&2){let n=t.$implicit,e=m(2);g("ngClass",B(3,He,n.id===e.selectedTagId)),d(),g("ngClass",n.tagIconName),d(2),P(n.tagName)}}function Xe(i,t){if(i&1&&(o(0,"div",21,22)(2,"div",23),I(3,Ke,4,5,"div",26,ze),s()()),i&2){let n=t.$implicit;d(3),D(n)}}var Ze=i=>({"bg-gray-900":i});function et(i,t){if(i&1&&u(0,"div",27),i&2){let n=t.$index,e=m();g("ngClass",B(1,Ze,e.currentTagGroupPage===n))}}function tt(i,t){if(i&1){let n=C();o(0,"div",28),p("click",function(){_(n);let a=m();return x(a.onClickDelete())}),u(1,"i",29),o(2,"p",30),l(3,"\u522A\u9664"),s()()}}function it(i,t){if(i&1){let n=C();o(0,"textarea",31),p("ngModelChange",function(a){_(n);let r=m();return x(r.description=a)}),s()}if(i&2){let n=m();g("ngModel",n.description)}}var Ae=(()=>{let t=class t{get StatusEnum(){return v}constructor(e,a,r,c,R){if(this.route=e,this.router=a,this.modalService=r,this.loaderService=c,this.ledgerService=R,this.maxTagGroupPage=0,this.currentTagGroupPage=0,this.translateFactor="translate(0, 0)",this.tagsGroup=[],this.selectedTagId="",this.description="",this.tagsGroup=this.route.snapshot.data.tagListGroup,this.expenseStatus=this.route.snapshot.data.data.expenseStatus,this.expenseStatus===v.Edit){let L=this.route.snapshot.data.data;this.price=parseInt(L.price),this.selectedTagId=L.tagId,this.description=L.description,this.date=L.date}else this.expenseStatus===v.Add&&(this.date=this.route.snapshot.data.data.date)}ngOnInit(){}ngAfterViewInit(){let e=this.scrollTagsRef.nativeElement.scrollWidth,a=this.tagGroupRef.nativeElement.scrollWidth;this.maxTagGroupPage=Math.ceil(e/a)}onSwipeRight(){if(this.currentTagGroupPage>0){this.currentTagGroupPage-=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onSwipeLeft(){if(this.currentTagGroupPage<this.maxTagGroupPage-1){this.currentTagGroupPage+=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onTagClick(e){this.selectedTagId===e?this.selectedTagId="":(this.priceInput.nativeElement.focus(),this.selectedTagId=e)}onClickBack(){this.router.navigateByUrl("/",{state:{transactionType:h.Expense,date:this.date.toDate()}})}onClickSave(){return Y(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.addExpense({date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{console.error("Error adding document: ",e)}).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:h.Expense,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop()))})}onClickEdit(){return Y(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.updateExpense({docId:this.route.snapshot.data.data.docId,date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{console.error("Error updating document: ",e)}).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:h.Expense,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop()))})}saveCheck(){let e=this.tagsGroup.some(a=>a.some(r=>r.id===this.selectedTagId));return!this.selectedTagId||!this.price||!e?(this.modalService.openConfirm({content:"\u8ACB\u8F38\u5165\u91D1\u984D\u8207\u9078\u64C7\u6A19\u7C64",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0}),!1):!0}onClickDescription(){this.modalService.openConfirm({title:"\u5099\u8A3B",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0,contentTemplateRef:this.templateRef})}onClickDelete(){this.modalService.openConfirm({content:"\u78BA\u8A8D\u522A\u9664\uFF1F",outsideClose:!0,onOk:()=>{this.doDelete()}})}doDelete(){this.loaderService.start(),this.ledgerService.deleteExpense(this.route.snapshot.data.data.docId).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:h.Expense,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop())}};t.\u0275fac=function(a){return new(a||t)(f(ie),f(M),f(q),f(W),f(y))},t.\u0275cmp=G({type:t,selectors:[["app-add-expense"]],viewQuery:function(a,r){if(a&1&&(k(Ye,5),k(Qe,5),k(Ue,5),k(Je,5)),a&2){let c;b(c=A())&&(r.scrollTagsRef=c.first),b(c=A())&&(r.tagGroupRef=c.first),b(c=A())&&(r.templateRef=c.first),b(c=A())&&(r.priceInput=c.first)}},standalone:!0,features:[F],decls:31,vars:6,consts:[[1,"bg-gray-800","text-white","p-4","flex","justify-between","items-center"],[1,"w-10",3,"click"],[1,"fas","fa-arrow-left"],[1,"text-lg"],["class","bg-gray-600 px-4 py-2 rounded"],[1,"bg-red-600","text-center","p-10","flex"],[1,"text-white","text-3xl","me-3","pt-2"],["autocomplete","off","id","tagName","type","number","inputmode","numeric",1,"w-full","text-right","bg-red-600","rounded","border","border-red-700","focus:border-red-500","focus:ring-2","focus:ring-red-900","text-3xl","outline-none","text-gray-100","py-1","px-3","leading-8","transition-colors","duration-200","ease-in-out",3,"ngModel","ngModelChange"],["priceInput",""],[1,"w-full","overflow-hidden"],[1,"flex","w-full","transition",3,"swipeLeft","swipeRight"],["scrollTags",""],[1,"flex","justify-center","my-4"],[1,"bg-white","py-4","border-t","border-gray-300"],[1,"flex","p-4","border-b","items-center","justify-between",3,"click"],[1,"flex","items-center"],[1,"mr-4","fas","fa-pencil-alt"],[1,"w-3/5","text-ellipsis","overflow-hidden","text-right","text-nowrap"],["class","flex p-4 border-b justify-center items-center bg-red-600 text-white text-2xl"],["templateRef",""],[1,"bg-gray-600","px-4","py-2","rounded",3,"click"],[1,"w-screen","text-center"],["tagGroup",""],[1,"flex","w-screen","flex-wrap"],[1,"w-1/3","py-8",3,"ngClass","click"],[3,"ngClass"],["class","w-1/3 py-8",3,"ngClass"],[1,"mx-2","w-2","h-2","bg-gray-500","rounded-full",3,"ngClass"],[1,"flex","p-4","border-b","justify-center","items-center","bg-red-600","text-white","text-2xl",3,"click"],[1,"fas","fa-trash","mr-2"],[1,""],["rows","10",1,"text-black","w-full","py-1","px-2","focus:border-none","focus:outline-none",3,"ngModel","ngModelChange"],["class","w-screen text-center"],["class","mx-2 w-2 h-2 bg-gray-500 rounded-full",3,"ngClass"]],template:function(a,r){a&1&&(o(0,"div",0)(1,"div",1),p("click",function(){return r.onClickBack()}),u(2,"i",2),s(),o(3,"h1",3),l(4,"\u65B0\u589E\u652F\u51FA"),s(),T(5,We,2,0,"button",4)(6,qe,2,0),s(),o(7,"div",5)(8,"span",6),l(9,"$"),s(),o(10,"input",7,8),p("ngModelChange",function(R){return r.price=R}),s()(),o(12,"div",9)(13,"div",10,11),p("swipeLeft",function(){return r.onSwipeLeft()})("swipeRight",function(){return r.onSwipeRight()}),I(15,Xe,5,0,"div",32,Q),s()(),o(17,"div",12),I(18,et,1,3,"div",33,Q),s(),o(20,"div",13)(21,"div",14),p("click",function(){return r.onClickDescription()}),o(22,"div",15),u(23,"i",16),o(24,"p"),l(25,"\u5099\u8A3B"),s()(),o(26,"span",17),l(27),s()(),T(28,tt,4,0,"div",18),s(),T(29,it,1,1,"ng-template",null,19,te)),a&2&&(d(5),E(5,r.expenseStatus===r.StatusEnum.Add?5:6),d(5),g("ngModel",r.price),d(3),ee("transform",r.translateFactor),d(2),D(r.tagsGroup),d(3),D(r.tagsGroup),d(9),w(" ",r.description," "),d(),E(28,r.expenseStatus===r.StatusEnum.Edit?28:-1))},dependencies:[X,J,z,re,H,K],styles:[".icon[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#d1d5db;-webkit-mask-size:cover;mask-size:cover;display:inline-block}.active-icon[_ngcontent-%COMP%]{background-color:#111827}.transition[_ngcontent-%COMP%]{transform:all .8s ease-out}"]});let i=t;return i})();var Me=()=>S(y).getTagList(h.Expense).pipe(j(1),Z(t=>t.reduce((e,a,r)=>{let c=Math.floor(r/9);return e[c]?e[c].push(a):e[c]=[a],e},[])));var Re=()=>{let i=S(y),t=S(M),n=t?.getCurrentNavigation()?.extras.state?.expenseStatus;if(n===v.Edit){let e=t?.getCurrentNavigation()?.extras.state?.docId;return i.getExpenseInfo(e).then(a=>{if(a.exists()){let r=a.data();return{expenseStatus:n,docId:e,date:r.date,price:r.price,tagId:r.tagId,description:r.description}}else t.navigate(["/"])})}else if(n===v.Add){let e=t?.getCurrentNavigation()?.extras.state?.date;if(e)return{expenseStatus:n,date:ne.fromDate(e)}}t.navigate(["/"])};var nt=["scrollTags"],rt=["tagGroup"],at=["templateRef"],ot=["priceInput"];function st(i,t){if(i&1){let n=C();o(0,"button",20),p("click",function(){_(n);let a=m();return x(a.onClickSave())}),l(1," \u5132\u5B58 "),s()}}function ct(i,t){if(i&1){let n=C();o(0,"button",20),p("click",function(){_(n);let a=m();return x(a.onClickEdit())}),l(1," \u5132\u5B58 "),s()}}var dt=(i,t)=>t.id,lt=i=>({"bg-neutral-300":i});function pt(i,t){if(i&1){let n=C();o(0,"div",24),p("click",function(){let r=_(n).$implicit,c=m(2);return x(c.onTagClick(r.id))}),u(1,"i",25),o(2,"p"),l(3),s()()}if(i&2){let n=t.$implicit,e=m(2);g("ngClass",B(3,lt,n.id===e.selectedTagId)),d(),g("ngClass",n.tagIconName),d(2),P(n.tagName)}}function ut(i,t){if(i&1&&(o(0,"div",21,22)(2,"div",23),I(3,pt,4,5,"div",26,dt),s()()),i&2){let n=t.$implicit;d(3),D(n)}}var mt=i=>({"bg-gray-900":i});function gt(i,t){if(i&1&&u(0,"div",27),i&2){let n=t.$index,e=m(2);g("ngClass",B(1,mt,e.currentTagGroupPage===n))}}function ft(i,t){if(i&1&&I(0,gt,1,3,"div",28,Q),i&2){let n=m();D(n.tagsGroup)}}function ht(i,t){if(i&1){let n=C();o(0,"div",29),p("click",function(){_(n);let a=m();return x(a.onClickDelete())}),u(1,"i",30),o(2,"p",31),l(3,"\u522A\u9664"),s()()}}function vt(i,t){if(i&1){let n=C();o(0,"textarea",32),p("ngModelChange",function(a){_(n);let r=m();return x(r.description=a)}),s()}if(i&2){let n=m();g("ngModel",n.description)}}var Le=(()=>{let t=class t{get StatusEnum(){return v}constructor(e,a,r,c,R){if(this.route=e,this.router=a,this.modalService=r,this.loaderService=c,this.ledgerService=R,this.maxTagGroupPage=0,this.currentTagGroupPage=0,this.translateFactor="translate(0, 0)",this.tagsGroup=[],this.selectedTagId="",this.description="",this.tagsGroup=this.route.snapshot.data.tagListGroup,this.incomeStatus=this.route.snapshot.data.data.incomeStatus,this.incomeStatus===v.Edit){let L=this.route.snapshot.data.data;this.price=parseInt(L.price),this.selectedTagId=L.tagId,this.description=L.description,this.date=L.date}else this.incomeStatus===v.Add&&(this.date=this.route.snapshot.data.data.date)}ngOnInit(){}ngAfterViewInit(){let e=this.scrollTagsRef.nativeElement.scrollWidth,a=this.tagGroupRef.nativeElement.scrollWidth;this.maxTagGroupPage=Math.ceil(e/a)}onSwipeRight(){if(this.currentTagGroupPage>0){this.currentTagGroupPage-=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onSwipeLeft(){if(this.currentTagGroupPage<this.maxTagGroupPage-1){this.currentTagGroupPage+=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onTagClick(e){this.selectedTagId===e?this.selectedTagId="":(this.priceInput.nativeElement.focus(),this.selectedTagId=e)}onClickBack(){this.router.navigateByUrl("/",{state:{transactionType:h.Income,date:this.date.toDate()}})}onClickSave(){return Y(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.addIncome({date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{console.error("Error adding document: ",e)}).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:h.Income,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop()))})}onClickEdit(){return Y(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.updateIncome({docId:this.route.snapshot.data.data.docId,date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{console.error("Error updating document: ",e)}).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:h.Income,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop()))})}saveCheck(){return!this.selectedTagId||!this.price?(this.modalService.openConfirm({content:"\u8ACB\u8F38\u5165\u91D1\u984D\u8207\u9078\u64C7\u6A19\u7C64",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0}),!1):!0}onClickDescription(){this.modalService.openConfirm({title:"\u5099\u8A3B",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0,contentTemplateRef:this.templateRef})}onClickDelete(){this.modalService.openConfirm({content:"\u78BA\u8A8D\u522A\u9664\uFF1F",outsideClose:!0,onOk:()=>{this.doDelete()}})}doDelete(){this.loaderService.start(),this.ledgerService.deleteIncome(this.route.snapshot.data.data.docId).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:h.Income,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop())}};t.\u0275fac=function(a){return new(a||t)(f(ie),f(M),f(q),f(W),f(y))},t.\u0275cmp=G({type:t,selectors:[["app-add-income"]],viewQuery:function(a,r){if(a&1&&(k(nt,5),k(rt,5),k(at,5),k(ot,5)),a&2){let c;b(c=A())&&(r.scrollTagsRef=c.first),b(c=A())&&(r.tagGroupRef=c.first),b(c=A())&&(r.templateRef=c.first),b(c=A())&&(r.priceInput=c.first)}},standalone:!0,features:[F],decls:30,vars:7,consts:[[1,"bg-gray-800","text-white","p-4","flex","justify-between","items-center"],[1,"w-10",3,"click"],[1,"fas","fa-arrow-left"],[1,"text-lg"],["class","bg-gray-600 px-4 py-2 rounded"],[1,"bg-green-600","text-center","p-10","flex"],[1,"text-white","text-3xl","me-3","pt-2"],["autocomplete","off","id","tagName","type","number","inputmode","numeric",1,"w-full","text-right","bg-green-600","rounded","border","border-green-700","focus:border-green-500","focus:ring-2","focus:ring-green-900","text-3xl","outline-none","text-gray-100","py-1","px-3","leading-8","transition-colors","duration-200","ease-in-out",3,"ngModel","ngModelChange"],["priceInput",""],[1,"w-full","overflow-hidden"],[1,"flex","w-full","transition",3,"swipeLeft","swipeRight"],["scrollTags",""],[1,"flex","justify-center","my-4"],[1,"bg-white","py-4","border-t","border-gray-300"],[1,"flex","p-4","border-b","items-center","justify-between",3,"click"],[1,"flex","items-center"],[1,"mr-4","fas","fa-pencil-alt"],[1,"w-3/5","text-ellipsis","overflow-hidden","text-right","text-nowrap"],["class","flex p-4 border-b justify-center items-center bg-green-600 text-white text-2xl"],["templateRef",""],[1,"bg-gray-600","px-4","py-2","rounded",3,"click"],[1,"w-screen","text-center"],["tagGroup",""],[1,"flex","w-screen","flex-wrap"],[1,"w-1/3","py-8",3,"ngClass","click"],[3,"ngClass"],["class","w-1/3 py-8",3,"ngClass"],[1,"mx-2","w-2","h-2","bg-gray-500","rounded-full",3,"ngClass"],["class","mx-2 w-2 h-2 bg-gray-500 rounded-full",3,"ngClass"],[1,"flex","p-4","border-b","justify-center","items-center","bg-green-600","text-white","text-2xl",3,"click"],[1,"fas","fa-trash","mr-2"],[1,""],["rows","10",1,"text-black","w-full",3,"ngModel","ngModelChange"],["class","w-screen text-center"]],template:function(a,r){a&1&&(o(0,"div",0)(1,"div",1),p("click",function(){return r.onClickBack()}),u(2,"i",2),s(),o(3,"h1",3),l(4,"\u65B0\u589E\u6536\u5165"),s(),T(5,st,2,0,"button",4)(6,ct,2,0),s(),o(7,"div",5)(8,"span",6),l(9,"$"),s(),o(10,"input",7,8),p("ngModelChange",function(R){return r.price=R}),s()(),o(12,"div",9)(13,"div",10,11),p("swipeLeft",function(){return r.onSwipeLeft()})("swipeRight",function(){return r.onSwipeRight()}),I(15,ut,5,0,"div",33,Q),s()(),o(17,"div",12),T(18,ft,2,0),s(),o(19,"div",13)(20,"div",14),p("click",function(){return r.onClickDescription()}),o(21,"div",15),u(22,"i",16),o(23,"p"),l(24,"\u5099\u8A3B"),s()(),o(25,"span",17),l(26),s()(),T(27,ht,4,0,"div",18),s(),T(28,vt,1,1,"ng-template",null,19,te)),a&2&&(d(5),E(5,r.incomeStatus===r.StatusEnum.Add?5:6),d(5),g("ngModel",r.price),d(3),ee("transform",r.translateFactor),d(2),D(r.tagsGroup),d(3),E(18,r.tagsGroup.length>1?18:-1),d(8),w(" ",r.description," "),d(),E(27,r.incomeStatus===r.StatusEnum.Edit?27:-1))},dependencies:[X,J,z,re,H,K],styles:["[_nghost-%COMP%]{display:block}"]});let i=t;return i})();var Be=()=>S(y).getTagList(h.Income).pipe(j(1),Z(t=>t.reduce((e,a,r)=>{let c=Math.floor(r/9);return e[c]?e[c].push(a):e[c]=[a],e},[])));var se=function(i){return i.Add="add",i.Edit="edit",i}(se||{});var Ge=()=>{let i=S(y),t=S(M),n=t?.getCurrentNavigation()?.extras.state?.incomeStatus;if(n===se.Edit){let e=t?.getCurrentNavigation()?.extras.state?.docId;return i.getIncomeInfo(e).then(a=>{if(a.exists()){let r=a.data();return{incomeStatus:n,docId:e,date:r.date,price:r.price,tagId:r.tagId,description:r.description}}else t.navigate(["/"])})}else if(n===se.Add){let e=t?.getCurrentNavigation()?.extras.state?.date;if(e)return{incomeStatus:n,date:ne.fromDate(e)}}t.navigate(["/"])};var xi=[{path:"",component:be,children:[{path:"",component:oe},{path:"addExpense",component:Ae,resolve:{tagListGroup:Me,data:Re}},{path:"addIncome",component:Le,resolve:{tagListGroup:Be,data:Ge}}]}];export{xi as LEDGER_ROUTES};
