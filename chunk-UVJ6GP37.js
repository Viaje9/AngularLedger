import{Eb as D,Fb as A,G as R,Ib as O,J as q,Jb as C,K as T,Kb as x,Lb as u,Mb as P,Nb as E,Ob as f,Qb as B,Rb as w,Ub as p,Wb as v,Xb as l,Yb as S,a as h,b as g,f as b,g as j,xc as k}from"./chunk-D2W2H3MJ.js";var nt=(()=>{let n=class n{constructor(t,e){this.firestore=t,this.auth=e,this.tagsCollection=C(this.firestore,this.tagsPath),this.expenseListCollection=C(this.firestore,this.expenseListPath),this.incomeListCollection=C(this.firestore,this.incomeListPath)}get tagsPath(){return`users/${this.auth.userUid}/tags`}get expenseListPath(){return`users/${this.auth.userUid}/expenseList`}get incomeListPath(){return`users/${this.auth.userUid}/incomeList`}getTagList(t){return f(p(this.tagsCollection,l("transactionType","==",t),w("sort","asc"))).then(e=>e.docs.map(s=>g(h({},s.data()),{id:s.id})))}getTagInfo(t){let e=u(this.firestore,this.tagsPath,t);return P(e)}getTagListWithId(t){return b(this,null,function*(){if(!t.length)return[];let e=this.auth.userUid,s=C(this.firestore,`users/${e}/tags`),r=p(s);return(yield E(r)).docs.map(d=>g(h({},d.data()),{id:d.id})).filter(d=>t.includes(d.id))})}getTagLastSort(t){return f(p(this.tagsCollection,l("transactionType","==",t),w("sort","desc"),B(1))).then(e=>e.docs.map(s=>s.data())).then(e=>e.length?e[0].sort:0)}addTagDoc(t){return O(this.tagsCollection,t)}updateTagDoc(t,e,s){let r=u(this.firestore,this.tagsPath,t);return v(r,{tagName:s,tagIconName:e})}removeTagDoc(t){let e=u(this.firestore,this.tagsPath,t);return x(e)}updateTagsSort(t){let e=S(this.firestore);return t.forEach(s=>{let r=u(this.firestore,this.tagsPath,s.id);e.update(r,{sort:s.sort})}),e.commit()}update(t){let e=S(this.firestore);return t.forEach(s=>{let r=u(this.firestore,this.tagsPath,s.id);e.update(r,{sort:s.sort,tagName:s.tagName,tagIconName:s.tagIconName,transactionType:s.transactionType})}),e.commit()}getExpenseInfo(t){let e=u(this.firestore,this.expenseListPath,t);return P(e)}addExpense(t){return O(this.expenseListCollection,t)}updateExpense(t){let e=u(this.firestore,this.expenseListPath,t.docId);return v(e,{date:t.date,price:t.price,tagId:t.tagId,description:t.description})}deleteExpense(t){let e=u(this.firestore,this.expenseListPath,t);return x(e)}getTodayExpenseList(t){let e=p(this.expenseListCollection,...this.queryDate(t,"date"));return E(e).then(s=>b(this,null,function*(){let r=s.docs.map(i=>g(h({},i.data()),{id:i.id})),a=r.map(i=>i.tagId),c=yield this.getTagListWithId(a);return r.map(i=>{let m=c.find(L=>L.id===i.tagId);return g(h({},i),{tagInfo:m})})}))}getTodayIncomeList(t){return f(p(this.incomeListCollection,...this.queryDate(t,"date"))).then(e=>e.docs.map(s=>g(h({},s.data()),{id:s.id}))).then(e=>b(this,null,function*(){let s=e.map(c=>c.tagId),r=yield this.getTagListWithId(s);return e.map(c=>{let d=r.find(i=>i.id===c.tagId);return g(h({},c),{tagInfo:d})})}))}getIncomeInfo(t){let e=u(this.firestore,this.incomeListPath,t);return P(e)}addIncome(t){return O(this.incomeListCollection,t)}updateIncome(t){let e=u(this.firestore,this.incomeListPath,t.docId);return v(e,{date:t.date,price:t.price,tagId:t.tagId,description:t.description})}deleteIncome(t){let e=u(this.firestore,this.incomeListPath,t);return x(e)}getBudgetAmount(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=D.fromDate(s),a=structuredClone(e);a.setHours(23,59,59,999);let c=D.fromDate(a),d=p(this.expenseListCollection,l("date",">=",r),l("date","<=",c));return f(d).then(i=>i.docs.reduce((m,L)=>m+parseInt(L.data().price),0))}getRangeItems(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=D.fromDate(s),a=structuredClone(e);a.setHours(23,59,59,999);let c=D.fromDate(a),d=p(this.expenseListCollection,l("date",">=",r),l("date","<=",c));return f(d).then(i=>b(this,null,function*(){return i.docs.map(m=>h({},m.data()))})).then(i=>b(this,null,function*(){let m=p(this.tagsCollection),H=(yield f(m)).docs.map(y=>h({id:y.id},y.data())),_=[];for(let y of i){let N=y,F=H.find(M=>M.id===N.tagId);y.tagInfo=F||{},_.push(y)}return _}))}queryDate(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=D.fromDate(s),a=structuredClone(t);a.setHours(23,59,59,999);let c=D.fromDate(a);return[l(e,">=",r),l(e,"<=",c)]}getExpenseList(){return f(this.expenseListCollection).then(t=>t.docs.map(e=>h({id:e.id},e.data())))}};n.\u0275fac=function(e){return new(e||n)(T(A),T(k))},n.\u0275prov=R({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var Z=q;function G(o){return!!o[Z]}var V=Symbol("__destroy"),W=Symbol("__decoratorApplied");function Y(o){return typeof o=="string"?Symbol(`__destroy__${o}`):V}function z(o){o.prototype[W]=!0}function J(o,n){o[n]&&(o[n].next(),o[n].complete(),o[n]=null)}function U(o){o instanceof j&&o.unsubscribe()}function K(o){Array.isArray(o)&&o.forEach(U)}function $(o,n){return function(){if(o&&o.call(this),J(this,Y()),n.arrayName&&K(this[n.arrayName]),n.checkProperties)for(let I in this)n.blackList?.includes(I)||U(this[I])}}function Q(o,n){o.prototype.ngOnDestroy=$(o.prototype.ngOnDestroy,n)}function X(o,n){let I=o.\u0275pipe;I.onDestroy=$(I.onDestroy,n)}function ft(o={}){return n=>{G(n)?X(n,o):Q(n,o),z(n)}}var mt=Symbol("CheckerHasBeenSet");export{nt as a,ft as b};
