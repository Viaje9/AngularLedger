import{E as j,Gb as q,H as R,Hb as D,I as T,Ib as A,Lb as O,Mb as C,Nb as P,Ob as u,Pb as v,Qb as p,Sb as B,Tb as E,Wb as l,Yb as x,Zb as f,_b as w,a as h,b as g,e as b,f as _}from"./chunk-IRYIX24Q.js";var ot=(()=>{let n=class n{constructor(t,e){this.firestore=t,this.auth=e,this.tagsCollection=C(this.firestore,this.tagsPath),this.expenseListCollection=C(this.firestore,this.expenseListPath),this.incomeListCollection=C(this.firestore,this.incomeListPath)}get tagsPath(){return`users/${this.auth.userUid}/tags`}get expenseListPath(){return`users/${this.auth.userUid}/expenseList`}get incomeListPath(){return`users/${this.auth.userUid}/incomeList`}getTagList(t){return p(l(this.tagsCollection,f("transactionType","==",t),E("sort","asc"))).then(e=>e.docs.map(s=>g(h({},s.data()),{id:s.id})))}getTagInfo(t){let e=u(this.firestore,this.tagsPath,t);return v(e)}getTagListWithId(t){return b(this,null,function*(){if(!t.length)return[];let e=this.auth.userUid,s=C(this.firestore,`users/${e}/tags`),r=l(s);return(yield p(r)).docs.map(d=>g(h({},d.data()),{id:d.id})).filter(d=>t.includes(d.id))})}getTagLastSort(t){return p(l(this.tagsCollection,f("transactionType","==",t),E("sort","desc"),B(1))).then(e=>e.docs.map(s=>s.data())).then(e=>e.length?e[0].sort:0)}addTagDoc(t){return O(this.tagsCollection,t)}updateTagDoc(t,e,s){let r=u(this.firestore,this.tagsPath,t);return x(r,{tagName:s,tagIconName:e})}removeTagDoc(t){let e=u(this.firestore,this.tagsPath,t);return P(e)}updateTagsSort(t){let e=w(this.firestore);return t.forEach(s=>{let r=u(this.firestore,this.tagsPath,s.id);e.update(r,{sort:s.sort})}),e.commit()}update(t){let e=w(this.firestore);return t.forEach(s=>{let r=u(this.firestore,this.tagsPath,s.id);e.update(r,{sort:s.sort,tagName:s.tagName,tagIconName:s.tagIconName,transactionType:s.transactionType})}),e.commit()}getExpenseInfo(t){let e=u(this.firestore,this.expenseListPath,t);return v(e)}addExpense(t){return O(this.expenseListCollection,t)}updateExpense(t){let e=u(this.firestore,this.expenseListPath,t.docId);return x(e,{date:t.date,price:t.price,tagId:t.tagId,description:t.description})}deleteExpense(t){let e=u(this.firestore,this.expenseListPath,t);return P(e)}getTodayExpenseList(t){let e=l(this.expenseListCollection,...this.queryDate(t,"date"));return p(e).then(s=>b(this,null,function*(){let r=s.docs.map(i=>g(h({},i.data()),{id:i.id})),a=r.map(i=>i.tagId),c=yield this.getTagListWithId(a);return r.map(i=>{let m=c.find(L=>L.id===i.tagId);return g(h({},i),{tagInfo:m})})}))}getTodayIncomeList(t){return p(l(this.incomeListCollection,...this.queryDate(t,"date"))).then(e=>e.docs.map(s=>g(h({},s.data()),{id:s.id}))).then(e=>b(this,null,function*(){let s=e.map(c=>c.tagId),r=yield this.getTagListWithId(s);return e.map(c=>{let d=r.find(i=>i.id===c.tagId);return g(h({},c),{tagInfo:d})})}))}getIncomeInfo(t){let e=u(this.firestore,this.incomeListPath,t);return v(e)}addIncome(t){return O(this.incomeListCollection,t)}updateIncome(t){let e=u(this.firestore,this.incomeListPath,t.docId);return x(e,{date:t.date,price:t.price,tagId:t.tagId,description:t.description})}deleteIncome(t){let e=u(this.firestore,this.incomeListPath,t);return P(e)}getBudgetAmount(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=D.fromDate(s),a=structuredClone(e);a.setHours(23,59,59,999);let c=D.fromDate(a),d=l(this.expenseListCollection,f("date",">=",r),f("date","<=",c));return p(d).then(i=>i.docs.reduce((m,L)=>m+parseInt(L.data().price),0))}getRangeItems(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=D.fromDate(s),a=structuredClone(e);a.setHours(23,59,59,999);let c=D.fromDate(a),d=l(this.expenseListCollection,f("date",">=",r),f("date","<=",c));return p(d).then(i=>b(this,null,function*(){return i.docs.map(m=>h({},m.data()))})).then(i=>b(this,null,function*(){let m=l(this.tagsCollection),$=(yield p(m)).docs.map(y=>h({id:y.id},y.data())),S=[];for(let y of i){let H=y,N=$.find(F=>F.id===H.tagId);y.tagInfo=N||{},S.push(y)}return S}))}queryDate(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=D.fromDate(s),a=structuredClone(t);a.setHours(23,59,59,999);let c=D.fromDate(a);return[f(e,">=",r),f(e,"<=",c)]}};n.\u0275fac=function(e){return new(e||n)(T(A),T(q))},n.\u0275prov=j({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var M=R;function Z(o){return!!o[M]}var G=Symbol("__destroy"),V=Symbol("__decoratorApplied");function W(o){return typeof o=="string"?Symbol(`__destroy__${o}`):G}function Y(o){o.prototype[V]=!0}function z(o,n){o[n]&&(o[n].next(),o[n].complete(),o[n]=null)}function k(o){o instanceof _&&o.unsubscribe()}function J(o){Array.isArray(o)&&o.forEach(k)}function U(o,n){return function(){if(o&&o.call(this),z(this,W()),n.arrayName&&J(this[n.arrayName]),n.checkProperties)for(let I in this)n.blackList?.includes(I)||k(this[I])}}function K(o,n){o.prototype.ngOnDestroy=U(o.prototype.ngOnDestroy,n)}function Q(o,n){let I=o.\u0275pipe;I.onDestroy=U(I.onDestroy,n)}function lt(o={}){return n=>{Z(n)?Q(n,o):K(n,o),Y(n)}}var ft=Symbol("CheckerHasBeenSet");export{ot as a,lt as b};
