import{a as B}from"./chunk-GLGDLUNE.js";import{a as Me,b as me,e as ue,f as he,g as ge,o as fe}from"./chunk-5GKAY5Z5.js";import{a as x,b as Ve}from"./chunk-UVJ6GP37.js";import{$ as pt,$c as Vt,Aa as Z,Ad as A,Ba as S,Ca as y,Da as a,Ea as c,Eb as de,Fa as f,Fd as O,G as st,Ga as w,H as ct,I as Ne,Ia as wt,Ja as h,K as ve,Ka as xt,Kd as L,L as k,La as v,Ld as pe,O as b,P as lt,Pa as G,Qa as P,Qc as It,Ra as Y,Rc as kt,Sa as le,Sc as Tt,Sd as F,Ta as Ie,Ua as X,Uc as Dt,V as l,Va as p,W as d,Wa as V,Wc as Et,X as dt,Xa as T,Ya as D,Za as E,Zc as Mt,_a as M,_c as re,a as Ce,aa as mt,ab as I,ad as Rt,b as rt,bb as K,ca as ut,cb as $,da as ht,db as q,dc as yt,e as Se,eb as ke,ec as Qe,f as ne,fc as $e,fd as Bt,ga as m,ha as u,hc as qe,i as ot,ib as Te,ic as He,id as At,jd as Ot,kc as Ue,kd as Lt,la as gt,lc as Je,ld as Ft,m as ye,mb as Ct,mc as ze,md as Ze,nd as Xe,oa as We,ob as H,od as Ke,pa as ae,qa as ft,qb as De,qc as U,rb as St,rc as bt,sa as j,sc as R,ta as _t,tc as Ee,u as at,ua as C,va as se,w as _e,wc as J,x as be,xd as z,ya as ce,za as vt}from"./chunk-D2W2H3MJ.js";var jt=(()=>{let t=class t{ngOnInit(){}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["app-ledger"]],standalone:!0,features:[I],decls:1,vars:0,template:function(i,n){i&1&&f(0,"router-outlet")},dependencies:[St,bt],styles:["[_nghost-%COMP%]{display:block}"]});let r=t;return r})();var it=Se(Me());function Kt(r,t){}var ei={bottomSheetState:yt("state",[He("void, hidden",qe({transform:"translateY(100%)"})),He("visible",qe({transform:"translateY(0%)"})),Ue("visible => void, visible => hidden",$e([Qe(`${Xe.COMPLEX} ${Ze.ACCELERATION_CURVE}`),ze("@*",Je(),{optional:!0})])),Ue("void => visible",$e([Qe(`${Xe.EXITING} ${Ze.DECELERATION_CURVE}`),ze("@*",Je(),{optional:!0})]))])},ti=(()=>{let t=class t extends Ot{constructor(e,i,n,s,g,_,Q,ie,Zt){super(e,i,n,s,g,_,Q,Zt),this._animationState="void",this._animationStateChanged=new ht,this._breakpointSubscription=ie.observe([re.Medium,re.Large,re.XLarge]).subscribe(()=>{this._toggleClass("mat-bottom-sheet-container-medium",ie.isMatched(re.Medium)),this._toggleClass("mat-bottom-sheet-container-large",ie.isMatched(re.Large)),this._toggleClass("mat-bottom-sheet-container-xlarge",ie.isMatched(re.XLarge))})}enter(){this._destroyed||(this._animationState="visible",this._changeDetectorRef.detectChanges())}exit(){this._destroyed||(this._animationState="hidden",this._changeDetectorRef.markForCheck())}ngOnDestroy(){super.ngOnDestroy(),this._breakpointSubscription.unsubscribe(),this._destroyed=!0}_onAnimationDone(e){e.toState==="visible"&&this._trapFocus(),this._animationStateChanged.emit(e)}_onAnimationStart(e){this._animationStateChanged.emit(e)}_captureInitialFocus(){}_toggleClass(e,i){this._elementRef.nativeElement.classList.toggle(e,i)}};t.\u0275fac=function(i){return new(i||t)(u(ut),u(Rt),u(Ct,8),u(At),u(Vt),u(gt),u(Dt),u(Mt),u(Bt))},t.\u0275cmp=b({type:t,selectors:[["mat-bottom-sheet-container"]],hostAttrs:["tabindex","-1",1,"mat-bottom-sheet-container"],hostVars:4,hostBindings:function(i,n){i&1&&xt("@state.start",function(g){return n._onAnimationStart(g)})("@state.done",function(g){return n._onAnimationDone(g)}),i&2&&(wt("@state",n._animationState),_t("role",n._config.role)("aria-modal",n._config.ariaModal)("aria-label",n._config.ariaLabel))},standalone:!0,features:[ft,I],decls:1,vars:0,consts:[["cdkPortalOutlet",""]],template:function(i,n){i&1&&j(0,Kt,0,0,"ng-template",0)},dependencies:[It],styles:[".mat-bottom-sheet-container{box-shadow:0px 8px 10px -5px rgba(0, 0, 0, 0.2), 0px 16px 24px 2px rgba(0, 0, 0, 0.14), 0px 6px 30px 5px rgba(0, 0, 0, 0.12);padding:8px 16px;min-width:100vw;box-sizing:border-box;display:block;outline:0;max-height:80vh;overflow:auto;background:var(--mat-bottom-sheet-container-background-color);color:var(--mat-bottom-sheet-container-text-color);font-family:var(--mat-bottom-sheet-container-text-font);font-size:var(--mat-bottom-sheet-container-text-size);line-height:var(--mat-bottom-sheet-container-text-line-height);font-weight:var(--mat-bottom-sheet-container-text-weight);letter-spacing:var(--mat-bottom-sheet-container-text-tracking)}.cdk-high-contrast-active .mat-bottom-sheet-container{outline:1px solid}.mat-bottom-sheet-container-xlarge,.mat-bottom-sheet-container-large,.mat-bottom-sheet-container-medium{border-top-left-radius:var(--mat-bottom-sheet-container-shape);border-top-right-radius:var(--mat-bottom-sheet-container-shape)}.mat-bottom-sheet-container-medium{min-width:384px;max-width:calc(100vw - 128px)}.mat-bottom-sheet-container-large{min-width:512px;max-width:calc(100vw - 256px)}.mat-bottom-sheet-container-xlarge{min-width:576px;max-width:calc(100vw - 384px)}"],encapsulation:2,data:{animation:[ei.bottomSheetState]}});let r=t;return r})(),tt=new Ne("MatBottomSheetData"),et=class{constructor(){this.data=null,this.hasBackdrop=!0,this.disableClose=!1,this.ariaLabel=null,this.ariaModal=!0,this.closeOnNavigation=!0,this.autoFocus="dialog",this.restoreFocus=!0}},Re=class{get instance(){return this._ref.componentInstance}get componentRef(){return this._ref.componentRef}constructor(t,o,e){this._ref=t,this._afterOpened=new ot,this.containerInstance=e,this.disableClose=o.disableClose,e._animationStateChanged.pipe(_e(i=>i.phaseName==="done"&&i.toState==="visible"),be(1)).subscribe(()=>{this._afterOpened.next(),this._afterOpened.complete()}),e._animationStateChanged.pipe(_e(i=>i.phaseName==="done"&&i.toState==="hidden"),be(1)).subscribe(()=>{clearTimeout(this._closeFallbackTimeout),this._ref.close(this._result)}),t.overlayRef.detachments().subscribe(()=>{this._ref.close(this._result)}),at(this.backdropClick(),this.keydownEvents().pipe(_e(i=>i.keyCode===27))).subscribe(i=>{!this.disableClose&&(i.type!=="keydown"||!Tt(i))&&(i.preventDefault(),this.dismiss())})}dismiss(t){this.containerInstance&&(this.containerInstance._animationStateChanged.pipe(_e(o=>o.phaseName==="start"),be(1)).subscribe(o=>{this._closeFallbackTimeout=setTimeout(()=>{this._ref.close(this._result)},o.totalTime+100),this._ref.overlayRef.detachBackdrop()}),this._result=t,this.containerInstance.exit(),this.containerInstance=null)}afterDismissed(){return this._ref.closed}afterOpened(){return this._afterOpened}backdropClick(){return this._ref.backdropClick}keydownEvents(){return this._ref.keydownEvents}},ii=new Ne("mat-bottom-sheet-default-options"),we=(()=>{let t=class t{get _openedBottomSheetRef(){let e=this._parentBottomSheet;return e?e._openedBottomSheetRef:this._bottomSheetRefAtThisLevel}set _openedBottomSheetRef(e){this._parentBottomSheet?this._parentBottomSheet._openedBottomSheetRef=e:this._bottomSheetRefAtThisLevel=e}constructor(e,i,n,s){this._overlay=e,this._parentBottomSheet=n,this._defaultOptions=s,this._bottomSheetRefAtThisLevel=null,this._dialog=i.get(Lt)}open(e,i){let n=Ce(Ce({},this._defaultOptions||new et),i),s;return this._dialog.open(e,rt(Ce({},n),{disableClose:!0,closeOnOverlayDetachments:!1,maxWidth:"100%",container:ti,scrollStrategy:n.scrollStrategy||this._overlay.scrollStrategies.block(),positionStrategy:this._overlay.position().global().centerHorizontally().bottom("0"),templateContext:()=>({bottomSheetRef:s}),providers:(g,_,Q)=>(s=new Re(g,n,Q),[{provide:Re,useValue:s},{provide:tt,useValue:n.data}])})),s.afterDismissed().subscribe(()=>{this._openedBottomSheetRef===s&&(this._openedBottomSheetRef=null)}),this._openedBottomSheetRef?(this._openedBottomSheetRef.afterDismissed().subscribe(()=>s.containerInstance?.enter()),this._openedBottomSheetRef.dismiss()):s.containerInstance.enter(),this._openedBottomSheetRef=s,s}dismiss(e){this._openedBottomSheetRef&&this._openedBottomSheetRef.dismiss(e)}ngOnDestroy(){this._bottomSheetRefAtThisLevel&&this._bottomSheetRefAtThisLevel.dismiss()}};t.\u0275fac=function(i){return new(i||t)(ve(Et),ve(pt),ve(t,12),ve(ii,8))},t.\u0275prov=st({token:t,factory:t.\u0275fac,providedIn:"root"});let r=t;return r})(),Be=(()=>{let t=class t{};t.\u0275fac=function(i){return new(i||t)},t.\u0275mod=lt({type:t}),t.\u0275inj=ct({providers:[we],imports:[Ft,Ke,kt,Ke]});let r=t;return r})();var ni=["descriptionRef"];function ri(r,t){if(r&1){let o=w();a(0,"li",6)(1,"span",10),h("click",function(){let i=l(o).$implicit,n=v();return d(n.onClickOption(i.name))}),p(2),c(),a(3,"span",11),h("click",function(){let i=l(o).$implicit,n=v();return d(n.onClickRemoveOption(i.id))}),dt(),a(4,"svg",12),f(5,"path",13),c()()()}if(r&2){let o=t.$implicit;m(2),V(o.name)}}var Ae=(()=>{let t=class t{constructor(){this.onSubmit=mt(),this.descriptionRef=ae.required("descriptionRef"),this.description=k(tt).description,this.cdr=k(Te),this.descriptionValue=We(""),this.descriptionOptions=We(JSON.parse(localStorage.getItem("keepDescItems")||"[]")),this.filterOptions=[],this.preventInputBlur=!1}ngOnInit(){this.descriptionValue.set(this.description),this.processOptions(this.descriptionValue())}processOptions(e=""){this.filterOptions=this.descriptionOptions().filter(i=>i.name.includes(e))}ngAfterViewInit(){this.descriptionRef().nativeElement.focus(),setTimeout(()=>{window.scrollTo({left:0,top:document.body.scrollHeight,behavior:"smooth"})},0)}onFocus(){this.processOptions(this.descriptionValue())}onChangeInput(e){e instanceof CompositionEvent&&this.processOptions(e.data),e instanceof Event&&this.processOptions(e.target.value)}onClickOption(e){this.descriptionValue.set(e),this.processOptions(this.descriptionValue()),this.preventInputBlur=!0,this.descriptionRef().nativeElement.focus()}onClickRemoveOption(e){let i=this.descriptionOptions().find(s=>s.id===e),n=this.descriptionOptions().filter(s=>s.id!==i?.id);localStorage.setItem("keepDescItems",JSON.stringify(n)),this.descriptionOptions.set(n),this.preventInputBlur=!0,this.processOptions(this.descriptionValue()),this.descriptionRef().nativeElement.focus()}onClickSubmit(){if(!this.descriptionOptions().some(i=>i.name.trim()===this.descriptionValue().trim())&&this.descriptionValue().trim()){let i=[{id:Date.now(),name:this.descriptionValue().trim()},...this.descriptionOptions()];localStorage.setItem("keepDescItems",JSON.stringify(i))}this.onSubmit.emit(this.descriptionValue())}onBlur(){setTimeout(()=>{this.preventInputBlur?this.preventInputBlur=!1:this.onClickSubmit()})}};t.\u0275fac=function(i){return new(i||t)},t.\u0275cmp=b({type:t,selectors:[["app-remark-bottom-sheet"]],viewQuery:function(i,n){i&1&&le(n.descriptionRef,ni,5),i&2&&Ie()},outputs:{onSubmit:"onSubmit"},standalone:!0,features:[I],decls:13,vars:1,consts:[["descriptionRef",""],[1,"h-96"],[1,"w-full","text-lg","py-2","text-center","font-medium","text-white","bg-gray-800"],[1,"px-3","pb-3"],[1,"optionsHeight","overflow-scroll","border","border-slate-200","mt-2"],[1,"bg-white","w-full","border","border-slate-300","rounded"],[1,"px-3","flex","justify-between","bg-white","border","border-slate-300"],[1,"flex","mt-2"],["autocomplete","off","type","text",1,"flex-1","rounded-l-lg","border","outline-none","py-1","px-3","leading-8","-mr-1",3,"ngModelChange","focus","input","compositionupdate","compositionend","blur","ngModel"],[1,"bg-blue-600","text-white","px-5","py-2","rounded-r-lg",3,"click"],[1,"flex-1","py-2",3,"click"],[1,"w-6","py-2","flex","items-center","justify-center",3,"click"],["width","24px","height","24px","viewBox","0 -960 960 960","fill","#00000"],["d","m334-296 146-146 146 146 38-38-146-146 146-146-38-38-146 146-146-146-38 38 146 146-146 146 38 38Zm146.17 196q-78.81 0-148.21-29.91T211.23-211.1q-51.34-51.28-81.28-120.59Q100-401.01 100-479.83q0-79.07 29.97-148.69t81.35-121.13q51.38-51.5 120.59-80.92Q401.13-860 479.83-860q79.06 0 148.67 29.39 69.62 29.39 121.13 80.85 51.52 51.46 80.94 121.02Q860-559.18 860-480.09t-29.39 148.15q-29.39 69.06-80.84 120.49-51.44 51.44-120.98 81.45-69.55 30-148.62 30Zm-.17-54q136.51 0 231.26-94.74Q806-343.49 806-480t-94.74-231.26Q616.51-806 480-806t-231.26 94.74Q154-616.51 154-480t94.74 231.26Q343.49-154 480-154Zm0-326Z"]],template:function(i,n){if(i&1){let s=w();a(0,"div",1)(1,"div",2),p(2," \u5099\u8A3B "),c(),a(3,"div",3)(4,"div",4)(5,"ul",5),S(6,ri,6,1,"li",6,vt),c()(),a(8,"div",7)(9,"input",8,0),M("ngModelChange",function(_){return l(s),E(n.descriptionValue,_)||(n.descriptionValue=_),d(_)}),h("focus",function(){return l(s),d(n.onFocus())})("input",function(_){return l(s),d(n.onChangeInput(_))})("compositionupdate",function(_){return l(s),d(n.onChangeInput(_))})("compositionend",function(_){return l(s),d(n.onChangeInput(_))})("blur",function(){return l(s),d(n.onBlur())}),c(),a(11,"button",9),h("click",function(){return l(s),d(n.onClickSubmit())}),p(12,"\u9001\u51FA"),c()()()()}i&2&&(m(6),y(n.filterOptions),m(3),D("ngModel",n.descriptionValue))},dependencies:[F,A,O,L],styles:[".cdk-overlay-container .mat-bottom-sheet-container{border-radius:10px 10px 0 0;padding:0}.optionsHeight[_ngcontent-%COMP%]{height:264px}"]});let r=t;return r})();var oi=["scrollTags"],ai=["tagGroup"],si=["priceInput"],ci=(r,t)=>t.id,li=r=>({"bg-neutral-300":r}),di=r=>({"bg-gray-900":r});function pi(r,t){if(r&1){let o=w();a(0,"div",23),h("click",function(){let i=l(o).$implicit,n=v(2);return d(n.onTagClick(i.id))}),f(1,"i",24),a(2,"p"),p(3),c()()}if(r&2){let o=t.$implicit,e=v(2);C("ngClass",K(3,li,o.id===e.selectedTagId)),m(),C("ngClass",o.tagIconName),m(2),V(o.tagName)}}function mi(r,t){if(r&1&&(a(0,"div",13,2)(2,"div",21),S(3,pi,4,5,"div",22,ci),c()()),r&2){let o=t.$implicit;m(3),y(o)}}function ui(r,t){if(r&1&&f(0,"div",15),r&2){let o=t.$index,e=v();C("ngClass",K(1,di,e.currentTagGroupPage===o))}}var Pt=(()=>{let t=class t{constructor(e,i,n,s,g,_,Q){this.route=e,this.router=i,this.modalService=n,this.loaderService=s,this.ledgerService=g,this.changeDetectorRef=_,this.bottomSheet=Q,this.scrollTagsRef=ae.required("scrollTags"),this.tagGroupRef=ae.required("tagGroup"),this.priceInput=ae.required("priceInput"),this.maxTagGroupPage=0,this.currentTagGroupPage=0,this.translateFactor="translate(0, 0)",this.tagsGroup=[],this.selectedTagId="",this.description="",this.tagsGroup=this.route.snapshot.data.tagListGroup;let ie=this.route.snapshot.queryParamMap.get("date")||"";me(ie)?this.date=de.fromDate((0,it.default)(ie,"YYYY-MM-DD").toDate()):this.router.navigate(["/"])}ngOnInit(){let{price:e,description:i}=this.route.snapshot.queryParams,n=parseInt(e);n>0&&(this.price=n),i&&(this.description=i)}ngAfterViewInit(){let e=this.scrollTagsRef().nativeElement.scrollWidth,i=this.tagGroupRef().nativeElement.scrollWidth;this.maxTagGroupPage=Math.ceil(e/i)}onSwipeRight(){if(this.currentTagGroupPage>0){this.currentTagGroupPage-=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onSwipeLeft(){if(this.currentTagGroupPage<this.maxTagGroupPage-1){this.currentTagGroupPage+=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onTagClick(e){this.selectedTagId===e?this.selectedTagId="":(this.price?.toString()||this.priceInput().nativeElement.focus(),this.selectedTagId=e)}onClickBack(){this.router.navigate(["/"],{queryParams:{date:(0,it.default)(this.date.toDate()).format("YYYY-MM-DD")}})}onClickSave(){return ne(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.addExpense({date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{this.showError()}).then(()=>{this.onClickBack()}).finally(()=>this.loaderService.stop()))})}saveCheck(){let e=this.tagsGroup.some(i=>i.some(n=>n.id===this.selectedTagId));return!this.selectedTagId||!this.price?.toString()||!e?(this.modalService.openConfirm({content:"\u8ACB\u8F38\u5165\u91D1\u984D\u8207\u9078\u64C7\u6A19\u7C64",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0}),!1):!0}onClickDescription(){let e=this.bottomSheet.open(Ae,{data:{description:this.description},panelClass:["max-h-96","relative"]});e.instance.onSubmit.subscribe(i=>{this.description=i,e.dismiss()})}showError(){this.modalService.openConfirm({content:"\u64CD\u4F5C\u5931\u6557",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0})}};t.\u0275fac=function(i){return new(i||t)(u(U),u(R),u(z),u(J),u(x),u(Te),u(we))},t.\u0275cmp=b({type:t,selectors:[["app-add-expense"]],viewQuery:function(i,n){i&1&&(le(n.scrollTagsRef,oi,5),le(n.tagGroupRef,ai,5),le(n.priceInput,si,5)),i&2&&Ie(3)},standalone:!0,features:[I],decls:28,vars:4,consts:[["priceInput",""],["scrollTags",""],["tagGroup",""],[1,"bg-gray-800","text-white","p-4","flex","justify-between","items-center"],[1,"w-10",3,"click"],[1,"fas","fa-arrow-left"],[1,"text-lg"],[1,"bg-gray-600","px-4","py-2","rounded",3,"click"],[1,"bg-red-600","text-center","p-10","flex"],[1,"text-white","text-3xl","me-3","pt-2"],["autocomplete","off","id","tagName","type","number","inputmode","numeric",1,"w-full","text-right","bg-red-600","rounded","border","border-red-700","focus:border-red-500","focus:ring-2","focus:ring-red-900","text-3xl","outline-none","text-gray-100","py-1","px-3","leading-8","transition-colors","duration-200","ease-in-out",3,"ngModelChange","ngModel"],[1,"w-full","overflow-hidden"],[1,"flex","w-full","transition",3,"swipeLeft","swipeRight"],[1,"w-screen","text-center"],[1,"flex","justify-center","my-4"],[1,"mx-2","w-2","h-2","bg-gray-500","rounded-full",3,"ngClass"],[1,"bg-white","py-4","border-t","border-gray-300"],[1,"flex","p-4","border-b","items-center","justify-between",3,"click"],[1,"flex","items-center"],[1,"mr-4","fas","fa-pencil-alt"],[1,"w-3/5","text-ellipsis","overflow-hidden","text-right","text-nowrap"],[1,"flex","w-screen","flex-wrap"],[1,"w-1/3","py-8",3,"ngClass"],[1,"w-1/3","py-8",3,"click","ngClass"],[3,"ngClass"]],template:function(i,n){if(i&1){let s=w();a(0,"div",3)(1,"div",4),h("click",function(){return l(s),d(n.onClickBack())}),f(2,"i",5),c(),a(3,"h1",6),p(4,"\u65B0\u589E\u652F\u51FA"),c(),a(5,"button",7),h("click",function(){return l(s),d(n.onClickSave())}),p(6," \u5132\u5B58 "),c()(),a(7,"div",8)(8,"span",9),p(9,"$"),c(),a(10,"input",10,0),M("ngModelChange",function(_){return l(s),E(n.price,_)||(n.price=_),d(_)}),c()(),a(12,"div",11)(13,"div",12,1),h("swipeLeft",function(){return l(s),d(n.onSwipeLeft())})("swipeRight",function(){return l(s),d(n.onSwipeRight())}),S(15,mi,5,0,"div",13,Z),c()(),a(17,"div",14),S(18,ui,1,3,"div",15,Z),c(),a(20,"div",16)(21,"div",17),h("click",function(){return l(s),d(n.onClickDescription())}),a(22,"div",18),f(23,"i",19),a(24,"p"),p(25,"\u5099\u8A3B"),c()(),a(26,"span",20),p(27),c()()()}i&2&&(m(10),D("ngModel",n.price),m(3),se("transform",n.translateFactor),m(2),y(n.tagsGroup),m(3),y(n.tagsGroup),m(9),T(" ",n.description," "))},dependencies:[F,H,A,pe,O,L,Be],styles:[".icon[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#d1d5db;-webkit-mask-size:cover;mask-size:cover;display:inline-block}.active-icon[_ngcontent-%COMP%]{background-color:#111827}.transition[_ngcontent-%COMP%]{transform:all .8s ease-out}"]});let r=t;return r})();var Yt=()=>k(x).getTagList(B.Expense).then(t=>t.reduce((e,i,n)=>{let s=Math.floor(n/9);return e[s]?e[s].push(i):e[s]=[i],e},[]));var N=function(r){return r.Add="add",r.Edit="edit",r}(N||{});var hi=["scrollTags"],gi=["tagGroup"],fi=["templateRef"],_i=["priceInput"],vi=(r,t)=>t.id,wi=r=>({"bg-neutral-300":r}),xi=r=>({"bg-gray-900":r});function Ci(r,t){if(r&1){let o=w();a(0,"button",22),h("click",function(){l(o);let i=v();return d(i.onClickSave())}),p(1," \u5132\u5B58 "),c()}}function Si(r,t){if(r&1){let o=w();a(0,"button",22),h("click",function(){l(o);let i=v();return d(i.onClickEdit())}),p(1," \u5132\u5B58 "),c()}}function yi(r,t){if(r&1){let o=w();a(0,"div",25),h("click",function(){let i=l(o).$implicit,n=v(2);return d(n.onTagClick(i.id))}),f(1,"i",26),a(2,"p"),p(3),c()()}if(r&2){let o=t.$implicit,e=v(2);C("ngClass",K(3,wi,o.id===e.selectedTagId)),m(),C("ngClass",o.tagIconName),m(2),V(o.tagName)}}function bi(r,t){if(r&1&&(a(0,"div",14,3)(2,"div",23),S(3,yi,4,5,"div",24,vi),c()()),r&2){let o=t.$implicit;m(3),y(o)}}function Ii(r,t){if(r&1&&f(0,"div",27),r&2){let o=t.$index,e=v(2);C("ngClass",K(1,xi,e.currentTagGroupPage===o))}}function ki(r,t){if(r&1&&S(0,Ii,1,3,"div",27,Z),r&2){let o=v();y(o.tagsGroup)}}function Ti(r,t){if(r&1){let o=w();a(0,"div",28),h("click",function(){l(o);let i=v();return d(i.onClickDelete())}),f(1,"i",29),a(2,"p",30),p(3,"\u522A\u9664"),c()()}}function Di(r,t){if(r&1){let o=w();a(0,"textarea",31),M("ngModelChange",function(i){l(o);let n=v();return E(n.description,i)||(n.description=i),d(i)}),c()}if(r&2){let o=v();D("ngModel",o.description)}}var Nt=(()=>{let t=class t{get StatusEnum(){return N}constructor(e,i,n,s,g){if(this.route=e,this.router=i,this.modalService=n,this.loaderService=s,this.ledgerService=g,this.maxTagGroupPage=0,this.currentTagGroupPage=0,this.translateFactor="translate(0, 0)",this.tagsGroup=[],this.selectedTagId="",this.description="",this.tagsGroup=this.route.snapshot.data.tagListGroup,this.incomeStatus=this.route.snapshot.data.data.incomeStatus,this.incomeStatus===N.Edit){let _=this.route.snapshot.data.data;this.price=parseInt(_.price),this.selectedTagId=_.tagId,this.description=_.description,this.date=_.date}else this.incomeStatus===N.Add&&(this.date=this.route.snapshot.data.data.date)}ngOnInit(){}ngAfterViewInit(){let e=this.scrollTagsRef.nativeElement.scrollWidth,i=this.tagGroupRef.nativeElement.scrollWidth;this.maxTagGroupPage=Math.ceil(e/i)}onSwipeRight(){if(this.currentTagGroupPage>0){this.currentTagGroupPage-=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onSwipeLeft(){if(this.currentTagGroupPage<this.maxTagGroupPage-1){this.currentTagGroupPage+=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onTagClick(e){this.selectedTagId===e?this.selectedTagId="":(this.priceInput.nativeElement.focus(),this.selectedTagId=e)}onClickBack(){this.router.navigateByUrl("/",{state:{transactionType:B.Income,date:this.date.toDate()}})}onClickSave(){return ne(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.addIncome({date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{console.error("Error adding document: ",e)}).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:B.Income,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop()))})}onClickEdit(){return ne(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.updateIncome({docId:this.route.snapshot.data.data.docId,date:this.date,price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{console.error("Error updating document: ",e)}).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:B.Income,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop()))})}saveCheck(){return!this.selectedTagId||!this.price?(this.modalService.openConfirm({content:"\u8ACB\u8F38\u5165\u91D1\u984D\u8207\u9078\u64C7\u6A19\u7C64",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0}),!1):!0}onClickDescription(){this.modalService.openConfirm({title:"\u5099\u8A3B",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0,contentTemplateRef:this.templateRef})}onClickDelete(){this.modalService.openConfirm({content:"\u78BA\u8A8D\u522A\u9664\uFF1F",outsideClose:!0,onOk:()=>{this.doDelete()}})}doDelete(){this.loaderService.start(),this.ledgerService.deleteIncome(this.route.snapshot.data.data.docId).then(()=>{this.router.navigateByUrl("/",{state:{transactionType:B.Income,date:this.date.toDate()}})}).finally(()=>this.loaderService.stop())}};t.\u0275fac=function(i){return new(i||t)(u(U),u(R),u(z),u(J),u(x))},t.\u0275cmp=b({type:t,selectors:[["app-add-income"]],viewQuery:function(i,n){if(i&1&&(G(hi,5),G(gi,5),G(fi,5),G(_i,5)),i&2){let s;P(s=Y())&&(n.scrollTagsRef=s.first),P(s=Y())&&(n.tagGroupRef=s.first),P(s=Y())&&(n.templateRef=s.first),P(s=Y())&&(n.priceInput=s.first)}},standalone:!0,features:[I],decls:30,vars:7,consts:[["priceInput",""],["scrollTags",""],["templateRef",""],["tagGroup",""],[1,"bg-gray-800","text-white","p-4","flex","justify-between","items-center"],[1,"w-10",3,"click"],[1,"fas","fa-arrow-left"],[1,"text-lg"],[1,"bg-gray-600","px-4","py-2","rounded"],[1,"bg-green-600","text-center","p-10","flex"],[1,"text-white","text-3xl","me-3","pt-2"],["autocomplete","off","id","tagName","type","number","inputmode","numeric",1,"w-full","text-right","bg-green-600","rounded","border","border-green-700","focus:border-green-500","focus:ring-2","focus:ring-green-900","text-3xl","outline-none","text-gray-100","py-1","px-3","leading-8","transition-colors","duration-200","ease-in-out",3,"ngModelChange","ngModel"],[1,"w-full","overflow-hidden"],[1,"flex","w-full","transition",3,"swipeLeft","swipeRight"],[1,"w-screen","text-center"],[1,"flex","justify-center","my-4"],[1,"bg-white","py-4","border-t","border-gray-300"],[1,"flex","p-4","border-b","items-center","justify-between",3,"click"],[1,"flex","items-center"],[1,"mr-4","fas","fa-pencil-alt"],[1,"w-3/5","text-ellipsis","overflow-hidden","text-right","text-nowrap"],[1,"flex","p-4","border-b","justify-center","items-center","bg-green-600","text-white","text-2xl"],[1,"bg-gray-600","px-4","py-2","rounded",3,"click"],[1,"flex","w-screen","flex-wrap"],[1,"w-1/3","py-8",3,"ngClass"],[1,"w-1/3","py-8",3,"click","ngClass"],[3,"ngClass"],[1,"mx-2","w-2","h-2","bg-gray-500","rounded-full",3,"ngClass"],[1,"flex","p-4","border-b","justify-center","items-center","bg-green-600","text-white","text-2xl",3,"click"],[1,"fas","fa-trash","mr-2"],[1,""],["rows","10",1,"text-black","w-full",3,"ngModelChange","ngModel"]],template:function(i,n){if(i&1){let s=w();a(0,"div",4)(1,"div",5),h("click",function(){return l(s),d(n.onClickBack())}),f(2,"i",6),c(),a(3,"h1",7),p(4,"\u65B0\u589E\u6536\u5165"),c(),j(5,Ci,2,0,"button",8)(6,Si,2,0,"button",8),c(),a(7,"div",9)(8,"span",10),p(9,"$"),c(),a(10,"input",11,0),M("ngModelChange",function(_){return l(s),E(n.price,_)||(n.price=_),d(_)}),c()(),a(12,"div",12)(13,"div",13,1),h("swipeLeft",function(){return l(s),d(n.onSwipeLeft())})("swipeRight",function(){return l(s),d(n.onSwipeRight())}),S(15,bi,5,0,"div",14,Z),c()(),a(17,"div",15),j(18,ki,2,0),c(),a(19,"div",16)(20,"div",17),h("click",function(){return l(s),d(n.onClickDescription())}),a(21,"div",18),f(22,"i",19),a(23,"p"),p(24,"\u5099\u8A3B"),c()(),a(25,"span",20),p(26),c()(),j(27,Ti,4,0,"div",21),c(),j(28,Di,1,1,"ng-template",null,2,ke)}i&2&&(m(5),ce(n.incomeStatus===n.StatusEnum.Add?5:6),m(5),D("ngModel",n.price),m(3),se("transform",n.translateFactor),m(2),y(n.tagsGroup),m(3),ce(n.tagsGroup.length>1?18:-1),m(8),T(" ",n.description," "),m(),ce(n.incomeStatus===n.StatusEnum.Edit?27:-1))},dependencies:[F,H,A,pe,O,L],styles:["[_nghost-%COMP%]{display:block}"]});let r=t;return r})();var Wt=()=>k(x).getTagList(B.Income).then(t=>t.reduce((e,i,n)=>{let s=Math.floor(n/9);return e[s]?e[s].push(i):e[s]=[i],e},[]));var Qt=()=>{let r=k(x),t=k(R),o=t?.getCurrentNavigation()?.extras.state?.incomeStatus;if(o===N.Edit){let e=t?.getCurrentNavigation()?.extras.state?.docId;return r.getIncomeInfo(e).then(i=>{if(i.exists()){let n=i.data();return{incomeStatus:o,docId:e,date:n.date,price:n.price,tagId:n.tagId,description:n.description}}else t.navigate(["/"])})}else if(o===N.Add){let e=t?.getCurrentNavigation()?.extras.state?.date;if(e)return{incomeStatus:o,date:de.fromDate(e)}}t.navigate(["/"])};var W=Se(Me());var Ei=(r,t)=>t.id;function Mi(r,t){if(r&1){let o=w();a(0,"div",29),h("click",function(){let i=l(o).$implicit,n=v();return d(n.goToEditExpense(i))}),a(1,"span"),f(2,"i",30),a(3,"span"),p(4),c()(),a(5,"span"),p(6),$(7,"number"),c()()}if(r&2){let o=t.$implicit;m(2),C("ngClass",o.tagInfo.tagIconName),m(2),V(o.tagInfo.tagName),m(2),T("$ ",q(7,3,o.price),"")}}function Vi(r,t){if(r&1&&(a(0,"div",19)(1,"div",5)(2,"div",31)(3,"div",32)(4,"span",33),p(5),$(6,"number"),c(),a(7,"span",34),p(8,"\u9031\u671F\u9918\u984D"),c()()(),a(9,"div",31)(10,"div",32)(11,"span",33),p(12),$(13,"number"),c(),a(14,"span",34),p(15,"\u6BCF\u65E5\u5269\u9918"),c()()(),a(16,"div",31)(17,"div",35)(18,"span",33),p(19),$(20,"number"),c(),a(21,"span",34),p(22,"\u5269\u9918\u9810\u7B97"),c()(),p(23," / "),a(24,"div",36)(25,"span",33),p(26),$(27,"number"),c(),a(28,"span",34),p(29,"\u9810\u7B97\u7E3D\u984D"),c()()()()()),r&2){let o=v();m(5),T("$ ",q(6,4,o.calculateRangeDayBudget()),""),m(7),T("$ ",q(13,6,o.calculateTodayBudget()),""),m(7),T("$ ",q(20,8,o.currentRangeBudget),""),m(7),T("$ ",q(27,10,o.budgetAmount),"")}}var ee,Pe=(ee=class{constructor(t,o,e,i,n){this.router=t,this.loaderService=o,this.ledgerService=e,this.modalService=i,this.activatedRoute=n,this.currentDate=new Date,this.ledgerItems=[],this.showBudget=localStorage.getItem("showBudget")==="1",this.budgetAmount=parseInt(localStorage.getItem("budgetAmount")||"0"),this.currentRangeBudget=0,this.startDate="",this.endDate="";let s=this.activatedRoute.snapshot.queryParams.date;me(s)&&(this.currentDate=(0,W.default)(s,"YYYY-MM-DD").toDate()),this.currentDate.setHours(0,0,0,0)}ngOnInit(){this.countBudget(),this.getExpenseList()}countBudget(){let t=parseInt(localStorage.getItem("selectedDate")||"0");if(t){let o=(0,W.default)(this.currentDate),e,i;o.date()>=t?(e=o.date(t),i=o.add(1,"month").date(t).subtract(1,"day")):(e=o.subtract(1,"month").date(t),i=o.date(t).subtract(1,"day"));let n=e.format("YYYY/MM/DD"),s=i.format("YYYY/MM/DD");n!==this.startDate&&s!==this.endDate&&(this.startDate=n,this.endDate=s,this.ledgerService.getBudgetAmount(e.toDate(),i.toDate()).then(g=>{this.currentRangeBudget=this.budgetAmount-g}))}}calculateDiffRangeDay(){let t=(0,W.default)(this.currentDate);return(0,W.default)(this.endDate,"YYYY/MM/DD").diff(t,"day")+1}calculateRangeDayBudget(){let t=(0,W.default)(this.currentDate),e=(0,W.default)(this.endDate,"YYYY/MM/DD").diff(t,"day")+1;return parseInt((this.currentRangeBudget/e).toFixed())-this.totalAmount()}calculateTodayBudget(){let t=(0,W.default)(this.startDate,"YYYY/MM/DD"),e=(0,W.default)(this.endDate,"YYYY/MM/DD").diff(t,"day")+1;return parseInt((this.budgetAmount/e).toFixed())-this.totalAmount()}onSwipeLeft(){let t=structuredClone(this.currentDate);t.setDate(this.currentDate.getDate()+1),this.currentDate=t,this.onDateChange()}onSwipeRight(){let t=structuredClone(this.currentDate);t.setDate(this.currentDate.getDate()-1),this.currentDate=t,this.onDateChange()}onDateChange(){this.getExpenseList(),this.countBudget()}formateDate(t){return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`}getExpenseList(t=0){t<2&&(this.loaderService.start(),this.ledgerService.getTodayExpenseList(this.currentDate).then(o=>{this.ledgerItems=o}).finally(()=>{this.loaderService.stop()}).catch(()=>{this.getExpenseList(t+1)}))}totalAmount(){return this.ledgerItems.reduce((t,o)=>t+parseInt(o.price),0)}goToEditExpense(t){this.router.navigate(["/editExpense"],{state:{docId:t.id}})}goToAdd(){this.router.navigate(["/addExpense"],{queryParams:{date:(0,W.default)(this.currentDate).format("YYYY-MM-DD")}})}goToIncome(){this.router.navigate(["/incomeOverview"],{queryParams:{date:(0,W.default)(this.currentDate).format("YYYY-MM-DD")}})}onClickStatistics(){localStorage.getItem("showBudget")==="1"?this.router.navigate(["/search/statisticsCharts"],{state:{date:this.currentDate}}):this.modalService.openConfirm({title:"\u901A\u77E5",content:"\u8ACB\u5148\u8A2D\u5B9A\u9810\u7B97\u9031\u671F\uFF0C\u518D\u67E5\u770B\u7D71\u8A08\u5716\u8868",okText:"\u78BA\u8A8D",outsideClose:!1,onOk:()=>{this.router.navigate(["/setting/budget"],{state:{date:this.currentDate}})}})}},ee.\u0275fac=function(o){return new(o||ee)(u(R),u(J),u(x),u(z),u(U))},ee.\u0275cmp=b({type:ee,selectors:[["app-expense-overview"]],standalone:!0,features:[I],decls:44,vars:7,consts:[["picker",""],[1,"bg-gray-100","h-dvh","flex","flex-col"],[1,"flex","flex-col","flex-1"],[1,"sticky","top-0"],[1,"p-4","text-white","bg-red-600"],[1,"flex","justify-between","items-center"],[1,"w-1/5","text-2xl"],[1,"flex","items-center","justify-center","w-3/5",3,"click"],["src","https://img.icons8.com/ios-filled/50/ffffff/calendar.png","alt","Calendar",1,"h-6","w-6","me-2"],["matInput","","readonly","",1,"bg-red-600","text-2xl","w-36","mr-3","focus:outline-none",3,"ngModelChange","dateChange","ngModel","matDatepicker"],["touchUi",""],[1,"w-1/5","flex","justify-end"],[1,"p-2","rounded-full","bg-red-800",3,"click"],["src","https://img.icons8.com/ios-filled/50/ffffff/plus-math.png","alt","Add",1,"h-6","w-6"],[1,"p-4","text-white","bg-red-500"],[1,"flex","justify-between","items-center","text-4xl"],[1,"wrapper","flex-1","p-4","space-y-2","bg-red-500",3,"swipeLeft","swipeRight"],[1,"bg-white","p-2","flex","justify-between","items-center"],[1,"sticky","bottom-0"],["routerLink","/setting/budget",1,"bg-red-300","p-4","text-red-800"],[1,"flex","justify-around","items-center","bg-gray-200"],[1,"w-1/4","p-4","pb-8","bg-gray-400"],[1,"fas","fa-arrow-up"],[1,"block","text-lg"],[1,"w-1/4","p-4","pb-8",3,"click"],[1,"fas","fa-arrow-down"],[1,"fas","fa-chart-line"],["routerLink","/setting",1,"w-1/4","p-4","pb-8"],[1,"fas","fa-cog"],[1,"bg-white","p-2","flex","justify-between","items-center",3,"click"],[1,"w-5","mr-1",3,"ngClass"],[1,"flex"],[1,"mr-1","flex","flex-col","items-center"],[1,"text-xl","block"],[1,"text-sm"],[1,"mr-1","flex","flex-col","items-end"],[1,"ml-1","flex","flex-col","items-end"]],template:function(o,e){if(o&1){let i=w();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5)(5,"div",6),p(6),c(),a(7,"div",7),h("click",function(){l(i);let s=X(11);return d(s.open())}),f(8,"img",8),a(9,"input",9),M("ngModelChange",function(s){return l(i),E(e.currentDate,s)||(e.currentDate=s),d(s)}),h("dateChange",function(){return l(i),d(e.onDateChange())}),c(),f(10,"mat-datepicker",10,0),c(),a(12,"div",11)(13,"button",12),h("click",function(){return l(i),d(e.goToAdd())}),f(14,"img",13),c()()()(),a(15,"div",14)(16,"div",15)(17,"span"),p(18,"TWD"),c(),a(19,"span"),p(20),$(21,"number"),c()()()(),a(22,"div",16),h("swipeLeft",function(){return l(i),d(e.onSwipeLeft())})("swipeRight",function(){return l(i),d(e.onSwipeRight())}),S(23,Mi,8,5,"div",17,Ei),c()(),a(25,"div",18),j(26,Vi,30,12,"div",19),a(27,"div",20)(28,"button",21),f(29,"i",22),a(30,"span",23),p(31,"\u652F\u51FA"),c()(),a(32,"button",24),h("click",function(){return l(i),d(e.goToIncome())}),f(33,"i",25),a(34,"span",23),p(35,"\u6536\u5165"),c()(),a(36,"button",24),h("click",function(){return l(i),d(e.onClickStatistics())}),f(37,"i",26),a(38,"span",23),p(39,"\u7D71\u8A08"),c()(),a(40,"button",27),f(41,"i",28),a(42,"span",23),p(43,"\u8A2D\u5B9A"),c()()()()()}if(o&2){let i=X(11);m(6),T(" ",e.calculateDiffRangeDay()||""," "),m(3),D("ngModel",e.currentDate),C("matDatepicker",i),m(11),V(q(21,5,e.totalAmount())),m(3),y(e.ledgerItems),m(3),ce(e.showBudget?26:-1)}},dependencies:[F,H,A,O,L,Ee,De,fe,ue,he,ge],styles:["[_nghost-%COMP%]{display:block}.wrapper[_ngcontent-%COMP%]{overflow-y:auto;touch-action:pan-y!important}"]}),ee);Pe=ye([Ve()],Pe);var nt=Se(Me());var Ri=(r,t)=>t.id;function Bi(r,t){if(r&1){let o=w();a(0,"div",28),h("click",function(){let i=l(o).$implicit,n=v();return d(n.goToEditTag(i))}),a(1,"span"),f(2,"i",29),a(3,"span"),p(4),c()(),a(5,"span"),p(6),$(7,"number"),c()()}if(r&2){let o=t.$implicit;m(2),C("ngClass",o.tagInfo.tagIconName),m(2),V(o.tagInfo.tagName),m(2),T("$ ",q(7,3,o.price),"")}}var te,Ye=(te=class{get TransactionTypeEnum(){return B}constructor(t,o,e,i,n){this.router=t,this.loaderService=o,this.ledgerService=e,this.modalService=i,this.activatedRoute=n,this.transactionType=this.TransactionTypeEnum.Income,this.currentDate=new Date,this.ledgerItems=[],this.showBudget=localStorage.getItem("showBudget")==="1",this.budgetAmount=parseInt(localStorage.getItem("budgetAmount")||"0"),this.currentRangeBudget=0,this.startDate="",this.endDate="";let s=this.activatedRoute.snapshot.queryParams.date;me(s)&&(this.currentDate=(0,nt.default)(s,"YYYY-MM-DD").toDate()),this.currentDate.setHours(0,0,0,0)}ngOnInit(){this.getIncomeList()}onSwipeLeft(){let t=structuredClone(this.currentDate);t.setDate(this.currentDate.getDate()+1),this.currentDate=t,this.onDateChange()}onSwipeRight(){let t=structuredClone(this.currentDate);t.setDate(this.currentDate.getDate()-1),this.currentDate=t,this.onDateChange()}onDateChange(){this.getIncomeList()}formateDate(t){return`${t.getFullYear()}/${t.getMonth()+1}/${t.getDate()}`}onClickAdd(){this.router.navigate(["/addIncome"],{state:{incomeStatus:N.Add,date:this.currentDate}})}getIncomeList(){this.loaderService.start(),this.ledgerService.getTodayIncomeList(this.currentDate).then(t=>{this.ledgerItems=t}).finally(()=>{this.loaderService.stop()})}totalAmount(){return this.ledgerItems.reduce((t,o)=>t+parseInt(o.price),0)}goToEditTag(t){let o={incomeStatus:N.Edit,docId:t.id,date:t.date,price:t.price,tagId:t.tagId,description:t.description};this.router.navigate(["/addIncome"],{state:o})}goToExpense(){this.router.navigate(["/expenseOverview"],{queryParams:{date:(0,nt.default)(this.currentDate).format("YYYY-MM-DD")}})}onClickStatistics(){localStorage.getItem("showBudget")==="1"?this.router.navigate(["/search/statisticsCharts"],{state:{date:this.currentDate}}):this.modalService.openConfirm({title:"\u901A\u77E5",content:"\u8ACB\u5148\u8A2D\u5B9A\u9810\u7B97\u9031\u671F\uFF0C\u518D\u67E5\u770B\u7D71\u8A08\u5716\u8868",okText:"\u78BA\u8A8D",outsideClose:!1,onOk:()=>{this.router.navigate(["/setting/budget"],{state:{date:this.currentDate}})}})}},te.\u0275fac=function(o){return new(o||te)(u(R),u(J),u(x),u(z),u(U))},te.\u0275cmp=b({type:te,selectors:[["app-income-overview"]],standalone:!0,features:[I],decls:42,vars:5,consts:[["picker",""],[1,"bg-gray-100","h-dvh","flex","flex-col"],[1,"flex","flex-col","flex-1"],[1,"sticky","top-0"],[1,"p-4","text-white","bg-green-600"],[1,"flex","justify-between","items-center"],[1,"w-1/5","text-2xl"],[1,"flex","items-center","justify-center","w-3/5",3,"click"],["src","https://img.icons8.com/ios-filled/50/ffffff/calendar.png","alt","Calendar",1,"h-6","w-6","me-2"],["matInput","","readonly","",1,"bg-green-600","text-2xl","w-36","mr-3","focus:outline-none",3,"ngModelChange","dateChange","ngModel","matDatepicker"],["touchUi",""],[1,"w-1/5","flex","justify-end"],[1,"bg-green-800","p-2","rounded-full",3,"click"],["src","https://img.icons8.com/ios-filled/50/ffffff/plus-math.png","alt","Add",1,"h-6","w-6"],[1,"bg-green-500","p-4","text-white"],[1,"flex","justify-between","items-center","text-4xl"],[1,"bg-green-500","wrapper","flex-1","p-4","space-y-2",3,"swipeLeft","swipeRight"],[1,"bg-white","p-2","flex","justify-between","items-center"],[1,"sticky","bottom-0"],[1,"flex","justify-around","items-center","bg-gray-200"],[1,"w-1/4","p-4","pb-8",3,"click"],[1,"fas","fa-arrow-up"],[1,"block","text-lg"],[1,"w-1/4","p-4","pb-8","bg-gray-400"],[1,"fas","fa-arrow-down"],[1,"fas","fa-chart-line"],["routerLink","/setting",1,"w-1/4","p-4","pb-8"],[1,"fas","fa-cog"],[1,"bg-white","p-2","flex","justify-between","items-center",3,"click"],[1,"w-5","mr-1",3,"ngClass"]],template:function(o,e){if(o&1){let i=w();a(0,"div",1)(1,"div",2)(2,"div",3)(3,"div",4)(4,"div",5),f(5,"div",6),a(6,"div",7),h("click",function(){l(i);let s=X(10);return d(s.open())}),f(7,"img",8),a(8,"input",9),M("ngModelChange",function(s){return l(i),E(e.currentDate,s)||(e.currentDate=s),d(s)}),h("dateChange",function(){return l(i),d(e.onDateChange())}),c(),f(9,"mat-datepicker",10,0),c(),a(11,"div",11)(12,"button",12),h("click",function(){return l(i),d(e.onClickAdd())}),f(13,"img",13),c()()()(),a(14,"div",14)(15,"div",15)(16,"span"),p(17,"TWD"),c(),a(18,"span"),p(19),$(20,"number"),c()()()(),a(21,"div",16),h("swipeLeft",function(){return l(i),d(e.onSwipeLeft())})("swipeRight",function(){return l(i),d(e.onSwipeRight())}),S(22,Bi,8,5,"div",17,Ri),c()(),a(24,"div",18)(25,"div",19)(26,"button",20),h("click",function(){return l(i),d(e.goToExpense())}),f(27,"i",21),a(28,"span",22),p(29,"\u652F\u51FA"),c()(),a(30,"button",23),f(31,"i",24),a(32,"span",22),p(33,"\u6536\u5165"),c()(),a(34,"button",20),h("click",function(){return l(i),d(e.onClickStatistics())}),f(35,"i",25),a(36,"span",22),p(37,"\u7D71\u8A08"),c()(),a(38,"button",26),f(39,"i",27),a(40,"span",22),p(41,"\u8A2D\u5B9A"),c()()()()()}if(o&2){let i=X(10);m(8),D("ngModel",e.currentDate),C("matDatepicker",i),m(11),V(q(20,3,e.totalAmount())),m(3),y(e.ledgerItems)}},dependencies:[F,H,A,O,L,Ee,De,fe,ue,he,ge],styles:["[_nghost-%COMP%]{display:block}.wrapper[_ngcontent-%COMP%]{overflow-y:auto;touch-action:pan-y!important}"]}),te);Ye=ye([Ve()],Ye);var Ht=Se(Me());var Ai=["scrollTags"],Oi=["tagGroup"],Li=["templateRef"],Fi=["priceInput"],ji=["descriptionInput"],Gi=(r,t)=>t.id,Pi=r=>({"bg-neutral-300":r}),Yi=r=>({"bg-gray-900":r});function Ni(r,t){if(r&1){let o=w();a(0,"div",33),h("click",function(){let i=l(o).$implicit,n=v(2);return d(n.onTagClick(i.id))}),f(1,"i",34),a(2,"p"),p(3),c()()}if(r&2){let o=t.$implicit,e=v(2);C("ngClass",K(3,Pi,o.id===e.selectedTagId)),m(),C("ngClass",o.tagIconName),m(2),V(o.tagName)}}function Wi(r,t){if(r&1&&(a(0,"div",16,4)(2,"div",31),S(3,Ni,4,5,"div",32,Gi),c()()),r&2){let o=t.$implicit;m(3),y(o)}}function Qi(r,t){if(r&1&&f(0,"div",18),r&2){let o=t.$index,e=v();C("ngClass",K(1,Yi,e.currentTagGroupPage===o))}}function $i(r,t){if(r&1){let o=w();a(0,"textarea",35,5),M("ngModelChange",function(i){l(o);let n=v();return E(n.description,i)||(n.description=i),d(i)}),c()}if(r&2){let o=v();D("ngModel",o.description)}}var Ut=(()=>{let t=class t{constructor(e,i,n,s,g,_){this.route=e,this.router=i,this.modalService=n,this.loaderService=s,this.ledgerService=g,this.bottomSheet=_,this.maxTagGroupPage=0,this.currentTagGroupPage=0,this.translateFactor="translate(0, 0)",this.tagsGroup=[],this.selectedTagId="",this.description="",this.expenseDate=new Date,this.tagsGroup=this.route.snapshot.data.tagListGroup;let Q=this.route.snapshot.data.data;this.price=parseInt(Q.price),this.selectedTagId=Q.tagId,this.description=Q.description,this.date=Q.date,this.expenseDate=this.date.toDate()}ngOnInit(){}ngAfterViewInit(){let e=this.scrollTagsRef.nativeElement.scrollWidth,i=this.tagGroupRef.nativeElement.scrollWidth;this.maxTagGroupPage=Math.ceil(e/i)}onSwipeRight(){if(this.currentTagGroupPage>0){this.currentTagGroupPage-=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onSwipeLeft(){if(this.currentTagGroupPage<this.maxTagGroupPage-1){this.currentTagGroupPage+=1;let e=this.currentTagGroupPage*100;this.translateFactor=`translate(-${e}%, 0)`}}onTagClick(e){this.selectedTagId===e?this.selectedTagId="":(this.price?.toString()||this.priceInput.nativeElement.focus(),this.selectedTagId=e)}onClickBack(){this.router.navigate(["/"],{queryParams:{date:(0,Ht.default)(this.expenseDate).format("YYYY-MM-DD")}})}onClickEdit(){return ne(this,null,function*(){this.saveCheck()&&(this.loaderService.start(),yield this.ledgerService.updateExpense({docId:this.route.snapshot.data.data.docId,date:de.fromDate(this.expenseDate),price:this.price.toString(),tagId:this.selectedTagId,description:this.description}).catch(e=>{this.showError()}).then(()=>{this.onClickBack()}).finally(()=>this.loaderService.stop()))})}saveCheck(){let e=this.tagsGroup.some(i=>i.some(n=>n.id===this.selectedTagId));return!this.selectedTagId||!this.price?.toString()||!e?(this.modalService.openConfirm({content:"\u8ACB\u8F38\u5165\u91D1\u984D\u8207\u9078\u64C7\u6A19\u7C64",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0}),!1):!0}onClickDescription(){let e=this.bottomSheet.open(Ae,{data:{description:this.description},panelClass:["max-h-96","relative"]});e.instance.onSubmit.subscribe(i=>{this.description=i,e.dismiss()})}onClickDelete(){this.modalService.openConfirm({content:"\u78BA\u8A8D\u522A\u9664\uFF1F",outsideClose:!0,onOk:()=>{this.doDelete()}})}doDelete(){this.loaderService.start(),this.ledgerService.deleteExpense(this.route.snapshot.data.data.docId).catch(e=>{this.showError()}).then(()=>{this.onClickBack()}).finally(()=>this.loaderService.stop())}showError(){this.modalService.openConfirm({content:"\u64CD\u4F5C\u5931\u6557",okText:"\u78BA\u8A8D",showCancelBtn:!1,outsideClose:!0})}};t.\u0275fac=function(i){return new(i||t)(u(U),u(R),u(z),u(J),u(x),u(we))},t.\u0275cmp=b({type:t,selectors:[["app-edit-expense"]],viewQuery:function(i,n){if(i&1&&(G(Ai,5),G(Oi,5),G(Li,5),G(Fi,5),G(ji,5)),i&2){let s;P(s=Y())&&(n.scrollTagsRef=s.first),P(s=Y())&&(n.tagGroupRef=s.first),P(s=Y())&&(n.templateRef=s.first),P(s=Y())&&(n.priceInput=s.first),P(s=Y())&&(n.descriptionInput=s.first)}},standalone:!0,features:[I],decls:43,vars:6,consts:[["priceInput",""],["scrollTags",""],["picker",""],["templateRef",""],["tagGroup",""],["descriptionInput",""],[1,"bg-gray-800","text-white","p-4","flex","justify-between","items-center"],[1,"w-10",3,"click"],[1,"fas","fa-arrow-left"],[1,"text-lg"],[1,"bg-gray-600","px-4","py-2","rounded",3,"click"],[1,"bg-red-600","text-center","p-10","flex"],[1,"text-white","text-3xl","me-3","pt-2"],["autocomplete","off","id","tagName","type","number","inputmode","numeric",1,"w-full","text-right","bg-red-600","rounded","border","border-red-700","focus:border-red-500","focus:ring-2","focus:ring-red-900","text-3xl","outline-none","text-gray-100","py-1","px-3","leading-8","transition-colors","duration-200","ease-in-out",3,"ngModelChange","ngModel"],[1,"w-full","overflow-hidden"],[1,"flex","w-full","transition",3,"swipeLeft","swipeRight"],[1,"w-screen","text-center"],[1,"flex","justify-center","my-4"],[1,"mx-2","w-2","h-2","bg-gray-500","rounded-full",3,"ngClass"],[1,"bg-white","py-4","border-t","border-gray-300"],[1,"flex","p-4","border-b","items-center","justify-between",3,"click"],[1,"flex","items-center"],[1,"mr-4","fas","fa-pencil-alt"],[1,"w-3/5","text-ellipsis","overflow-hidden","text-right","text-nowrap"],[1,"mr-4","fas","fa-calendar-alt"],[1,"w-3/5","text-right"],["matInput","","readonly","",1,"bg-transparent","text-right","w-full",3,"ngModelChange","ngModel","matDatepicker"],["touchUi",""],[1,"flex","p-4","border-b","justify-center","items-center","bg-red-600","text-white","text-2xl",3,"click"],[1,"fas","fa-trash","mr-2"],[1,""],[1,"flex","w-screen","flex-wrap"],[1,"w-1/3","py-8",3,"ngClass"],[1,"w-1/3","py-8",3,"click","ngClass"],[3,"ngClass"],["rows","10",1,"text-black","w-full","py-1","px-2","focus:border-none","focus:outline-none",3,"ngModelChange","ngModel"]],template:function(i,n){if(i&1){let s=w();a(0,"div",6)(1,"div",7),h("click",function(){return l(s),d(n.onClickBack())}),f(2,"i",8),c(),a(3,"h1",9),p(4,"\u65B0\u589E\u652F\u51FA"),c(),a(5,"button",10),h("click",function(){return l(s),d(n.onClickEdit())}),p(6," \u5132\u5B58 "),c()(),a(7,"div",11)(8,"span",12),p(9,"$"),c(),a(10,"input",13,0),M("ngModelChange",function(_){return l(s),E(n.price,_)||(n.price=_),d(_)}),c()(),a(12,"div",14)(13,"div",15,1),h("swipeLeft",function(){return l(s),d(n.onSwipeLeft())})("swipeRight",function(){return l(s),d(n.onSwipeRight())}),S(15,Wi,5,0,"div",16,Z),c()(),a(17,"div",17),S(18,Qi,1,3,"div",18,Z),c(),a(20,"div",19)(21,"div",20),h("click",function(){return l(s),d(n.onClickDescription())}),a(22,"div",21),f(23,"i",22),a(24,"p"),p(25,"\u5099\u8A3B"),c()(),a(26,"span",23),p(27),c()(),a(28,"div",20),h("click",function(){l(s);let _=X(36);return d(_.open())}),a(29,"div",21),f(30,"i",24),a(31,"p"),p(32,"\u65E5\u671F"),c()(),a(33,"div",25)(34,"input",26),M("ngModelChange",function(_){return l(s),E(n.expenseDate,_)||(n.expenseDate=_),d(_)}),c(),f(35,"mat-datepicker",27,2),c()(),a(37,"div",28),h("click",function(){return l(s),d(n.onClickDelete())}),f(38,"i",29),a(39,"p",30),p(40,"\u522A\u9664"),c()()(),j(41,$i,2,1,"ng-template",null,3,ke)}if(i&2){let s=X(36);m(10),D("ngModel",n.price),m(3),se("transform",n.translateFactor),m(2),y(n.tagsGroup),m(3),y(n.tagsGroup),m(9),T(" ",n.description," "),m(7),D("ngModel",n.expenseDate),C("matDatepicker",s)}},dependencies:[F,H,A,pe,O,L,Be,fe,ue,he,ge],styles:[".icon[_ngcontent-%COMP%]{width:40px;height:40px;background-color:#d1d5db;-webkit-mask-size:cover;mask-size:cover;display:inline-block}.active-icon[_ngcontent-%COMP%]{background-color:#111827}.transition[_ngcontent-%COMP%]{transform:all .8s ease-out}"]});let r=t;return r})();var Jt=()=>k(x).getTagList(B.Expense).then(t=>t.reduce((e,i,n)=>{let s=Math.floor(n/9);return e[s]?e[s].push(i):e[s]=[i],e},[]));var zt=()=>{let r=k(x),t=k(R),o=t?.getCurrentNavigation()?.extras.state?.docId;return r.getExpenseInfo(o).then(e=>{if(e.exists()){let i=e.data();return{docId:o,date:i.date,price:i.price,tagId:i.tagId,description:i.description}}else t.navigate(["/"])})};var Gr=[{path:"",component:jt,children:[{path:"",pathMatch:"full",redirectTo:"expenseOverview"},{path:"expenseOverview",component:Pe},{path:"editExpense",component:Ut,resolve:{tagListGroup:Jt,data:zt}},{path:"incomeOverview",component:Ye},{path:"addExpense",component:Pt,resolve:{tagListGroup:Yt}},{path:"addIncome",component:Nt,resolve:{tagListGroup:Wt,data:Qt}}]}];export{Gr as LEDGER_ROUTES};
