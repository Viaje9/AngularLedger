import{Cb as L,Db as b,E as R,Eb as O,F as q,Fb as d,Gb as x,Hb as f,I as E,Jb as k,Kb as w,Nb as p,Pb as P,Qb as l,Rb as S,a as I,b as T,e as D,f as j,xb as A,yb as m,zb as B}from"./chunk-FCHOOI32.js";var ot=(()=>{let n=class n{constructor(t,e){this.firestore=t,this.auth=e,this.tagsCollection=b(this.firestore,this.tagsPath),this.expenseListCollection=b(this.firestore,this.expenseListPath),this.incomeListCollection=b(this.firestore,this.incomeListPath)}get tagsPath(){return`users/${this.auth.userUid}/tags`}get expenseListPath(){return`users/${this.auth.userUid}/expenseList`}get incomeListPath(){return`users/${this.auth.userUid}/incomeList`}getTagList(t){return f(p(this.tagsCollection,l("transactionType","==",t),w("sort","asc"))).then(e=>e.docs.map(s=>T(I({},s.data()),{id:s.id})))}getTagInfo(t){let e=d(this.firestore,this.tagsPath,t);return x(e)}getTagListWithId(t){return D(this,null,function*(){if(!t.length)return[];let e=this.auth.userUid,s=b(this.firestore,`users/${e}/tags`),r=p(s);return(yield f(r)).docs.map(u=>T(I({},u.data()),{id:u.id})).filter(u=>t.includes(u.id))})}getTagLastSort(t){return f(p(this.tagsCollection,l("transactionType","==",t),w("sort","desc"),k(1))).then(e=>e.docs.map(s=>s.data())).then(e=>e.length?e[0].sort:0)}addTagDoc(t){return L(this.tagsCollection,t)}updateTagDoc(t,e,s){let r=d(this.firestore,this.tagsPath,t);return P(r,{tagName:s,tagIconName:e})}removeTagDoc(t){let e=d(this.firestore,this.tagsPath,t);return O(e)}updateTagsSort(t){let e=S(this.firestore);return t.forEach(s=>{let r=d(this.firestore,this.tagsPath,s.id);e.update(r,{sort:s.sort})}),e.commit()}update(t){let e=S(this.firestore);return t.forEach(s=>{let r=d(this.firestore,this.tagsPath,s.id);e.update(r,{sort:s.sort,tagName:s.tagName,tagIconName:s.tagIconName,transactionType:s.transactionType})}),e.commit()}getExpenseInfo(t){let e=d(this.firestore,this.expenseListPath,t);return x(e)}addExpense(t){return L(this.expenseListCollection,t)}updateExpense(t){let e=d(this.firestore,this.expenseListPath,t.docId);return P(e,{date:t.date,price:t.price,tagId:t.tagId,description:t.description})}deleteExpense(t){let e=d(this.firestore,this.expenseListPath,t);return O(e)}getTodayExpenseList(t){let e=p(this.expenseListCollection,...this.queryDate(t,"date"));return f(e).then(s=>D(this,null,function*(){let r=[],c=s.docs.map(i=>i.data()),a=c.map(i=>i.tagId),u=yield this.getTagListWithId(a);for(let i of c){let h=i,C=u.find(v=>v.id===h.tagId);i.tagInfo=C||{},r.push(i)}return r}))}getTodayIncomeList(t){return f(p(this.incomeListCollection,...this.queryDate(t,"date"))).then(e=>e.docs.map(s=>s.data())).then(e=>D(this,null,function*(){let s=[],r=e.map(a=>a.tagId),c=yield this.getTagListWithId(r);for(let a of e){let u=a,i=c.find(h=>h.id===u.tagId);a.tagInfo=i||{},s.push(a)}return s}))}getIncomeInfo(t){let e=d(this.firestore,this.incomeListPath,t);return x(e)}addIncome(t){return L(this.incomeListCollection,t)}updateIncome(t){let e=d(this.firestore,this.incomeListPath,t.docId);return P(e,{date:t.date,price:t.price,tagId:t.tagId,description:t.description})}deleteIncome(t){let e=d(this.firestore,this.incomeListPath,t);return O(e)}getBudgetAmount(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=m.fromDate(s),c=structuredClone(e);c.setHours(23,59,59,999);let a=m.fromDate(c),u=p(this.expenseListCollection,l("date",">=",r),l("date","<=",a));return f(u).then(i=>i.docs.reduce((h,C)=>h+parseInt(C.data().price),0))}getRangeItems(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=m.fromDate(s),c=structuredClone(e);c.setHours(23,59,59,999);let a=m.fromDate(c),u=p(this.expenseListCollection,l("date",">=",r),l("date","<=",a));return f(u).then(i=>D(this,null,function*(){return i.docs.map(h=>I({},h.data()))})).then(i=>D(this,null,function*(){let h=p(this.tagsCollection),v=(yield f(h)).docs.map(g=>I({id:g.id},g.data())),_=[];for(let g of i){let H=g,N=v.find(F=>F.id===H.tagId);g.tagInfo=N||{},_.push(g)}return _}))}queryDate(t,e){let s=structuredClone(t);s.setHours(0,0,0,0);let r=m.fromDate(s),c=structuredClone(t);c.setHours(23,59,59,999);let a=m.fromDate(c);return[l(e,">=",r),l(e,"<=",a)]}};n.\u0275fac=function(e){return new(e||n)(E(B),E(A))},n.\u0275prov=q({token:n,factory:n.\u0275fac,providedIn:"root"});let o=n;return o})();var M=R;function Z(o){return!!o[M]}var G=Symbol("__destroy"),V=Symbol("__decoratorApplied");function W(o){return typeof o=="string"?Symbol(`__destroy__${o}`):G}function Y(o){o.prototype[V]=!0}function z(o,n){o[n]&&(o[n].next(),o[n].complete(),o[n]=null)}function U(o){o instanceof j&&o.unsubscribe()}function J(o){Array.isArray(o)&&o.forEach(U)}function $(o,n){return function(){if(o&&o.call(this),z(this,W()),n.arrayName&&J(this[n.arrayName]),n.checkProperties)for(let y in this)n.blackList?.includes(y)||U(this[y])}}function K(o,n){o.prototype.ngOnDestroy=$(o.prototype.ngOnDestroy,n)}function Q(o,n){let y=o.\u0275pipe;y.onDestroy=$(y.onDestroy,n)}function pt(o={}){return n=>{Z(n)?Q(n,o):K(n,o),Y(n)}}var lt=Symbol("CheckerHasBeenSet");export{ot as a,pt as b};
